<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Source: Features/Classification.php - 10up ClassifAI Hook Docs</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">

	<link href="https://fonts.googleapis.com/css?family=IBM+Plex+Mono|IBM+Plex+Sans:300,400|Playfair+Display:900&display=swap" rel="stylesheet">
    <link type="text/css" rel="stylesheet" href="styles-10up.css">
</head>

<body>

<div id="main">

	
    <h1 class="page-title">Source: Features/Classification.php</h1>
	

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>&lt;?php

namespace Classifai\Features;

use Classifai\Services\LanguageProcessing;
use Classifai\Providers\Watson\NLU;
use Classifai\Providers\OpenAI\Embeddings;
use WP_REST_Server;
use WP_REST_Request;
use WP_Error;

use function Classifai\get_post_statuses_for_language_settings;
use function Classifai\get_post_types_for_language_settings;
use function Classifai\check_term_permissions;
use function Classifai\get_classification_feature_enabled;
use function Classifai\get_classification_feature_taxonomy;
use function Classifai\get_asset_info;
use function Classifai\get_classification_mode;

/**
 * Class Classification
 */
class Classification extends Feature {
	/**
	 * ID of the current feature.
	 *
	 * @var string
	 */
	const ID = 'feature_classification';

	/**
	 * Constructor.
	 */
	public function __construct() {
		$this->label = __( 'Classification', 'classifai' );

		// Contains all providers that are registered to the service.
		$this->provider_instances = $this->get_provider_instances( LanguageProcessing::get_service_providers() );

		// Contains just the providers this feature supports.
		$this->supported_providers = [
			NLU::ID        => __( 'IBM Watson NLU', 'classifai' ),
			Embeddings::ID => __( 'OpenAI Embeddings', 'classifai' ),
		];
	}

	/**
	 * Set up necessary hooks.
	 *
	 * We utilize this so we can register the REST route.
	 */
	public function setup() {
		parent::setup();
		add_action( 'rest_api_init', [ $this, 'register_endpoints' ] );
	}

	/**
	 * Set up necessary hooks.
	 */
	public function feature_setup() {
		$post_types = $this->get_supported_post_types();
		if ( ! empty( $post_types ) ) {
			foreach ( $post_types as $post_type ) {
				add_action( 'rest_after_insert_' . $post_type, [ $this, 'rest_after_insert' ] );
			}
		}

		add_action( 'admin_enqueue_scripts', [ $this, 'enqueue_admin_assets' ] );
		add_action( 'enqueue_block_editor_assets', [ $this, 'enqueue_editor_assets' ] );
		add_action( 'classifai_after_feature_settings_form', [ $this, 'render_previewer' ] );
		add_action( 'rest_api_init', [ $this, 'add_process_content_meta_to_rest_api' ] );
		add_action( 'wp_ajax_classifai_get_post_search_results', array( $this, 'get_post_search_results' ) );
		add_filter( 'default_post_metadata', [ $this, 'default_post_metadata' ], 10, 3 );

		// Support the Classic Editor.
		add_action( 'add_meta_boxes', [ $this, 'add_meta_box' ], 10, 2 );
		add_action( 'save_post', [ $this, 'save_meta_box' ] );
		add_action( 'admin_post_classifai_classify_post', array( $this, 'classifai_classify_post' ) );
		add_action( 'admin_notices', [ $this, 'show_error_if' ] );
		add_filter( 'removable_query_args', [ $this, 'removable_query_args' ] );
	}

	/**
	 * Register any needed endpoints.
	 */
	public function register_endpoints() {
		$post_types = $this->get_supported_post_types();
		foreach ( $post_types as $post_type ) {
			register_meta(
				$post_type,
				'_classifai_error',
				[
					'show_in_rest'  => true,
					'single'        => true,
					'auth_callback' => '__return_true',
				]
			);
		}

		register_rest_route(
			'classifai/v1',
			'classify/(?P&lt;id>\d+)',
			[
				'methods'             => WP_REST_Server::READABLE,
				'callback'            => [ $this, 'rest_endpoint_callback' ],
				'args'                => array(
					'id'        => array(
						'required'          => true,
						'type'              => 'integer',
						'sanitize_callback' => 'absint',
						'description'       => esc_html__( 'Post ID to classify.', 'classifai' ),
					),
					'linkTerms' => array(
						'type'        => 'boolean',
						'description' => esc_html__( 'Whether to link terms or not.', 'classifai' ),
						'default'     => true,
					),
				),
				'permission_callback' => [ $this, 'classify_permissions_check' ],
			]
		);
	}

	/**
	 * Check if a given request has access to run classification.
	 *
	 * @param WP_REST_Request $request Full data about the request.
	 * @return WP_Error|bool
	 */
	public function classify_permissions_check( WP_REST_Request $request ) {
		$post_id = $request->get_param( 'id' );

		// Ensure we have a logged in user that can edit the item.
		if ( empty( $post_id ) || ! current_user_can( 'edit_post', $post_id ) ) {
			return false;
		}

		$post_type     = get_post_type( $post_id );
		$post_type_obj = get_post_type_object( $post_type );

		// Ensure the post type is allowed in REST endpoints.
		if ( ! $post_type || empty( $post_type_obj ) || empty( $post_type_obj->show_in_rest ) ) {
			return false;
		}

		// For all enabled features, ensure the user has proper permissions to add/edit terms.
		$provider_instance = $this->get_feature_provider_instance();
		if ( empty( $provider_instance->nlu_features ) ) {
			return new WP_Error( 'not_enabled', esc_html__( 'Classification not configured correctly for the selected provider.', 'classifai' ) );
		}

		foreach ( $provider_instance->nlu_features as $feature_name => $feature ) {
			if ( ! get_classification_feature_enabled( $feature_name ) ) {
				continue;
			}

			$taxonomy   = get_classification_feature_taxonomy( $feature_name );
			$permission = check_term_permissions( $taxonomy );

			if ( is_wp_error( $permission ) ) {
				return $permission;
			}
		}

		$post_status   = get_post_status( $post_id );
		$supported     = $this->get_supported_post_types();
		$post_statuses = $this->get_supported_post_statuses();

		// Check if processing allowed.
		if (
			! in_array( $post_status, $post_statuses, true ) ||
			! in_array( $post_type, $supported, true ) ||
			! $this->is_feature_enabled()
		) {
			return new WP_Error( 'not_enabled', esc_html__( 'Classification not enabled for current item.', 'classifai' ) );
		}

		return true;
	}

	/**
	 * Generic request handler for all our custom routes.
	 *
	 * @param WP_REST_Request $request The full request object.
	 * @return \WP_REST_Response
	 */
	public function rest_endpoint_callback( WP_REST_Request $request ) {
		$route = $request->get_route();

		if ( strpos( $route, '/classifai/v1/classify' ) === 0 ) {
			$results = $this->run(
				$request->get_param( 'id' ),
				'classify',
				[
					'link_terms' => $request->get_param( 'linkTerms' ),
				]
			);

			// Save results or return the results that need saved.
			if ( ! is_wp_error( $results ) ) {
				$results = $this->save( $request->get_param( 'id' ), $results, $request->get_param( 'linkTerms' ) ?? true );
			}

			return rest_ensure_response(
				[
					'terms'              => $results,
					'feature_taxonomies' => $this->get_all_feature_taxonomies(),
				]
			);
		}

		return parent::rest_endpoint_callback( $request );
	}

	/**
	 * Save or return the classification results.
	 *
	 * If $link is true, we link the terms to the item. If
	 * it is false, we just return the terms that need linked
	 * so they can show in the UI.
	 *
	 * @param int   $post_id The post ID.
	 * @param array $results Term results
	 * @param bool  $link Whether to link the terms or not.
	 * @return array|WP_Error
	 */
	public function save( int $post_id, array $results, bool $link = true ) {
		$provider_instance = $this->get_feature_provider_instance();

		switch ( $provider_instance::ID ) {
			case NLU::ID:
				$results = $provider_instance->link( $post_id, $results, $link );
				break;
			case Embeddings::ID:
				$results = $provider_instance->set_terms( $post_id, $results, $link );
				break;
		}

		return $results;
	}

	/**
	 * Run classification after an item has been inserted via REST.
	 *
	 * @param \WP_Post $post Post object.
	 */
	public function rest_after_insert( \WP_Post $post ) {
		$supported_post_types = $this->get_supported_post_types();
		$post_statuses        = $this->get_supported_post_statuses();

		// Ensure the post type and status is allowed.
		if (
			! in_array( $post->post_type, $supported_post_types, true ) ||
			! in_array( $post->post_status, $post_statuses, true )
		) {
			return;
		}

		// Check if processing on save is disabled.
		if ( 'no' === get_post_meta( $post->ID, '_classifai_process_content', true ) ) {
			return;
		}

		$results = $this->run( $post->ID, 'classify' );

		if ( ! empty( $results ) &amp;&amp; ! is_wp_error( $results ) ) {
			$this->save( $post->ID, $results );
			delete_post_meta( $post->ID, '_classifai_error' );
		} elseif ( is_wp_error( $results ) ) {
			update_post_meta(
				$post->ID,
				'_classifai_error',
				wp_json_encode(
					[
						'code'    => $results->get_error_code(),
						'message' => $results->get_error_message(),
					]
				)
			);
		}
	}

	/**
	 * Enqueue the admin scripts.
	 */
	public function enqueue_admin_assets() {
		wp_enqueue_script(
			'classifai-language-processing-script',
			CLASSIFAI_PLUGIN_URL . 'dist/language-processing.js',
			get_asset_info( 'language-processing', 'dependencies' ),
			get_asset_info( 'language-processing', 'version' ),
			true
		);

		wp_enqueue_style(
			'classifai-language-processing-style',
			CLASSIFAI_PLUGIN_URL . 'dist/language-processing.css',
			array(),
			get_asset_info( 'language-processing', 'version' ),
			'all'
		);
	}

	/**
	 * Enqueue editor assets.
	 */
	public function enqueue_editor_assets() {
		global $post;

		wp_enqueue_script(
			'classifai-editor',
			CLASSIFAI_PLUGIN_URL . 'dist/editor.js',
			get_asset_info( 'editor', 'dependencies' ),
			get_asset_info( 'editor', 'version' ),
			true
		);

		if ( empty( $post ) ) {
			return;
		}

		wp_enqueue_script(
			'classifai-gutenberg-plugin',
			CLASSIFAI_PLUGIN_URL . 'dist/gutenberg-plugin.js',
			array_merge( get_asset_info( 'gutenberg-plugin', 'dependencies' ), array( 'lodash' ) ),
			get_asset_info( 'gutenberg-plugin', 'version' ),
			true
		);

		wp_add_inline_script(
			'classifai-gutenberg-plugin',
			sprintf(
				'var classifaiPostData = %s;',
				wp_json_encode(
					[
						'NLUEnabled'           => $this->is_feature_enabled(),
						'supportedPostTypes'   => $this->get_supported_post_types(),
						'supportedPostStatues' => $this->get_supported_post_statuses(),
						'noPermissions'        => ! is_user_logged_in() || ! current_user_can( 'edit_post', $post->ID ),
					]
				)
			),
			'before'
		);
	}

	/**
	 * Add `classifai_process_content` to the REST API for view/edit.
	 */
	public function add_process_content_meta_to_rest_api() {
		$supported_post_types = $this->get_supported_post_types();

		register_rest_field(
			$supported_post_types,
			'classifai_process_content',
			[
				'get_callback'    => function ( $data ) {
					$process_content = get_post_meta( $data['id'], '_classifai_process_content', true );
					return ( 'no' === $process_content ) ? 'no' : 'yes';
				},
				'update_callback' => function ( $value, $data ) {
					$value = ( 'no' === $value ) ? 'no' : 'yes';
					return update_post_meta( $data->ID, '_classifai_process_content', $value );
				},
				'schema'          => [
					'type'    => 'string',
					'context' => [ 'view', 'edit' ],
				],
			]
		);
	}

	/**
	 * Searches and returns posts.
	 */
	public function get_post_search_results() {
		$nonce = isset( $_POST['nonce'] ) ? sanitize_text_field( wp_unslash( $_POST['nonce'] ) ) : false;

		if ( ! ( $nonce &amp;&amp; wp_verify_nonce( $nonce, 'classifai-previewer-action' ) ) ) {
			wp_send_json_error( esc_html__( 'Failed nonce check.', 'classifai' ) );
		}

		$search_term   = isset( $_POST['search'] ) ? sanitize_text_field( wp_unslash( $_POST['search'] ) ) : '';
		$post_types    = isset( $_POST['post_types'] ) ? explode( ',', sanitize_text_field( wp_unslash( $_POST['post_types'] ) ) ) : 'post';
		$post_statuses = isset( $_POST['post_status'] ) ? explode( ',', sanitize_text_field( wp_unslash( $_POST['post_status'] ) ) ) : 'publish';

		$posts = get_posts(
			array(
				'post_type'   => $post_types,
				'post_status' => $post_statuses,
				's'           => $search_term,
			)
		);

		wp_send_json_success( $posts );
	}

	/**
	 * Add metabox to enable/disable language processing.
	 *
	 * @param string   $post_type Post type.
	 * @param \WP_Post $post WP_Post object.
	 */
	public function add_meta_box( string $post_type, $post ) {
		$supported_post_types = $this->get_supported_post_types();
		$post_statuses        = $this->get_supported_post_statuses();
		$post_status          = get_post_status( $post );

		if (
			in_array( $post_type, $supported_post_types, true ) &amp;&amp;
			in_array( $post_status, $post_statuses, true )
		) {
			add_meta_box(
				'classifai_language_processing_metabox',
				__( 'ClassifAI Language Processing', 'classifai' ),
				[ $this, 'render_meta_box' ],
				null,
				'side',
				'high',
				array( '__back_compat_meta_box' => true )
			);
		}
	}

	/**
	 * Render metabox content.
	 *
	 * @param \WP_Post $post WP_Post object.
	 */
	public function render_meta_box( \WP_Post $post ) {
		wp_nonce_field( 'classifai_language_processing_meta_action', 'classifai_language_processing_meta' );
		$process_content = get_post_meta( $post->ID, '_classifai_process_content', true );
		$process_content = ( 'no' === $process_content ) ? 'no' : 'yes';
		?>

		&lt;p>
			&lt;label for="classifai-process-content">
				&lt;input type="checkbox" value="yes" name="_classifai_process_content" id="classifai-process-content" &lt;?php checked( $process_content, 'yes' ); ?> />
				&lt;?php esc_html_e( 'Automatically tag content on update', 'classifai' ); ?>
			&lt;/label>
		&lt;/p>

		&lt;div class="classifai-clasify-post-wrapper" style="display: none;">
			&lt;a href="&lt;?php echo esc_url( wp_nonce_url( admin_url( 'admin-post.php?action=classifai_classify_post&amp;post_id=' . $post->ID ), 'classifai_classify_post_action', 'classifai_classify_post_nonce' ) ); ?>" class="button button-classify-post">
				&lt;?php esc_html_e( 'Suggest terms &amp; tags', 'classifai' ); ?>
			&lt;/a>
		&lt;/div>
		&lt;?php
	}

	/**
	 * Handles saving the metabox.
	 *
	 * @param int $post_id Current post ID.
	 */
	public function save_meta_box( int $post_id ) {
		if (
			wp_is_post_autosave( $post_id ) ||
			wp_is_post_revision( $post_id ) ||
			! current_user_can( 'edit_post', $post_id )
		) {
			return;
		}

		if (
			empty( $_POST['classifai_language_processing_meta'] ) ||
			! wp_verify_nonce( sanitize_text_field( wp_unslash( $_POST['classifai_language_processing_meta'] ) ), 'classifai_language_processing_meta_action' )
		) {
			return;
		}

		$classifai_process_content = isset( $_POST['_classifai_process_content'] ) ? sanitize_key( wp_unslash( $_POST['_classifai_process_content'] ) ) : '';

		if ( 'yes' !== $classifai_process_content ) {
			update_post_meta( $post_id, '_classifai_process_content', 'no' );
		} else {
			update_post_meta( $post_id, '_classifai_process_content', 'yes' );

			$results = $this->run( $post_id, 'classify' );

			if ( ! empty( $results ) &amp;&amp; ! is_wp_error( $results ) ) {
				$this->save( $post_id, $results );
				delete_post_meta( $post_id, '_classifai_error' );
			} elseif ( is_wp_error( $results ) ) {
				update_post_meta(
					$post_id,
					'_classifai_error',
					wp_json_encode(
						[
							'code'    => $results->get_error_code(),
							'message' => $results->get_error_message(),
						]
					)
				);
			}
		}
	}

	/**
	 * Classify post manually.
	 *
	 * Fires when the Classify button is clicked
	 * in the Classic Editor.
	 */
	public function classifai_classify_post() {
		if (
			empty( $_GET['classifai_classify_post_nonce'] ) ||
			! wp_verify_nonce( sanitize_text_field( wp_unslash( $_GET['classifai_classify_post_nonce'] ) ), 'classifai_classify_post_action' )
		) {
			wp_die( esc_html__( 'You don\'t have permission to perform this operation.', 'classifai' ) );
		}

		$post_id = isset( $_GET['post_id'] ) ? absint( $_GET['post_id'] ) : 0;

		if ( ! $post_id ) {
			exit();
		}

		// Check to see if processing is disabled and overwrite that.
		// Since we are manually classifying, we want to force this.
		$enabled = get_post_meta( $post_id, '_classifai_process_content', true );
		if ( 'yes' !== $enabled ) {
			update_post_meta( $post_id, '_classifai_process_content', 'yes' );
		}

		$results = $this->run( $post_id, 'classify' );

		// Ensure the processing value is changed back to what it was.
		if ( 'yes' !== $enabled ) {
			update_post_meta( $post_id, '_classifai_process_content', 'no' );
		}

		$classified = array();

		if ( ! empty( $results ) &amp;&amp; ! is_wp_error( $results ) ) {
			$this->save( $post_id, $results );
			$classified = array( 'classifai_classify' => 1 );
			delete_post_meta( $post_id, '_classifai_error' );
		} elseif ( is_wp_error( $results ) ) {
			update_post_meta(
				$post_id,
				'_classifai_error',
				wp_json_encode(
					[
						'code'    => $results->get_error_code(),
						'message' => $results->get_error_message(),
					]
				)
			);
		}

		wp_safe_redirect( esc_url_raw( add_query_arg( $classified, get_edit_post_link( $post_id, 'edit' ) ) ) );
		exit();
	}

	/**
	 * Outputs an admin notice with the error message if needed.
	 */
	public function show_error_if() {
		global $post;

		if ( empty( $post ) ) {
			return;
		}

		$post_id = $post->ID;

		if ( empty( $post_id ) ) {
			return;
		}

		$error = get_post_meta( $post_id, '_classifai_error', true );

		if ( ! empty( $error ) ) {
			delete_post_meta( $post_id, '_classifai_error' );
			$error   = (array) json_decode( $error );
			$code    = ! empty( $error['code'] ) ? $error['code'] : 500;
			$message = ! empty( $error['message'] ) ? $error['message'] : 'Unknown API error';

			?>
			&lt;div class="notice notice-error is-dismissible">
				&lt;p>
					&lt;?php esc_html_e( 'Error: Failed to classify content.', 'classifai' ); ?>
				&lt;/p>
				&lt;p>
					&lt;?php echo esc_html( $code ); ?>
					-
					&lt;?php echo esc_html( $message ); ?>
				&lt;/p>
			&lt;/div>
			&lt;?php
		}

		// Display classify post success message for manually classified post.
		// phpcs:ignore WordPress.Security.NonceVerification.Recommended
		$classified = isset( $_GET['classifai_classify'] ) ? intval( wp_unslash( $_GET['classifai_classify'] ) ) : 0;

		if ( 1 === $classified ) {
			$post_type       = get_post_type_object( get_post_type( $post ) );
			$post_type_label = esc_html__( 'Post', 'classifai' );
			if ( $post_type ) {
				$post_type_label = $post_type->labels->singular_name;
			}
			?>

			&lt;div class="notice notice-success is-dismissible">
				&lt;p>
					&lt;?php
					// translators: %s is post type label.
					printf( esc_html__( '%s classified successfully.', 'classifai' ), esc_html( $post_type_label ) );
					?>
				&lt;/p>
			&lt;/div>

			&lt;?php
		}
	}

	/**
	 * Sets the default value for the _classifai_process_content meta key.
	 *
	 * @param mixed  $value     The value get_metadata() should return - a single metadata value,
	 *                          or an array of values.
	 * @param int    $object_id Object ID.
	 * @param string $meta_key  Meta key.
	 * @return mixed
	 */
	public function default_post_metadata( $value, int $object_id, string $meta_key ) {
		if ( '_classifai_process_content' === $meta_key ) {
			if ( 'automatic_classification' === get_classification_mode() ) {
				return 'yes';
			} else {
				return 'no';
			}
		}

		return $value;
	}

	/**
	 * Add "classifai_classify" in list of query variable names to remove.
	 *
	 * @param array $removable_query_args An array of query variable names to remove from a URL.
	 * @return array
	 */
	public function removable_query_args( array $removable_query_args ): array {
		$removable_query_args[] = 'classifai_classify';
		return $removable_query_args;
	}

	/**
	 * Renders the previewer window for the feature.
	 *
	 * @param string $active_feature The active feature.
	 */
	public function render_previewer( string $active_feature ) {
		if ( self::ID !== $active_feature || ! $this->is_feature_enabled() ) {
			return;
		}

		$provider_instance       = $this->get_feature_provider_instance();
		$nlu_features            = array();
		$supported_post_statuses = $this->get_supported_post_statuses();
		$supported_post_types    = $this->get_supported_post_types();

		$posts_to_preview = get_posts(
			array(
				'post_type'      => $supported_post_types,
				'post_status'    => $supported_post_statuses,
				'posts_per_page' => 10,
			)
		);

		if ( ! empty( $provider_instance->nlu_features ) ) {
			$nlu_features = $provider_instance->nlu_features;
		}
		?>

		&lt;div id="classifai-post-preview-app">
			&lt;h2>&lt;?php esc_html_e( 'Preview Language Processing', 'classifai' ); ?>&lt;/h2>

			&lt;div id="classifai-post-preview-controls">
				&lt;select id="classifai-preview-post-selector">
					&lt;?php foreach ( $posts_to_preview as $post ) : ?>
						&lt;option value="&lt;?php echo esc_attr( $post->ID ); ?>">&lt;?php echo esc_html( $post->post_title ); ?>&lt;/option>
					&lt;?php endforeach; ?>
				&lt;/select>

				&lt;?php wp_nonce_field( 'classifai-previewer-action', 'classifai-previewer-nonce' ); ?>

				&lt;button type="button" class="button" id="get-classifier-preview-data-btn">
					&lt;span>&lt;?php esc_html_e( 'Preview', 'classifai' ); ?>&lt;/span>
				&lt;/button>
			&lt;/div>

			&lt;div id="classifai-post-preview-wrapper">
				&lt;?php
				foreach ( $nlu_features as $feature_slug => $feature ) :
					if ( ! get_classification_feature_enabled( $feature_slug ) ) {
						continue;
					}
					?>

					&lt;div class="tax-row tax-row--&lt;?php echo esc_attr( $feature_slug ); ?>">
						&lt;div class="tax-type">&lt;?php echo esc_html( $feature['feature'] ); ?>&lt;/div>
					&lt;/div>

					&lt;?php
				endforeach;
				?>
			&lt;/div>
		&lt;/div>

		&lt;?php
	}

	/**
	 * Get the description for the enable field.
	 *
	 * @return string
	 */
	public function get_enable_description(): string {
		return esc_html__( 'Enables automatic content classification.', 'classifai' );
	}

	/**
	 * Add any needed custom fields.
	 */
	public function add_custom_settings_fields() {
		$settings          = $this->get_settings();
		$provider_instance = $this->get_feature_provider_instance();
		$nlu_features      = array();
		$post_statuses     = get_post_statuses_for_language_settings();
		$post_types        = get_post_types_for_language_settings();
		$post_type_options = array();

		if ( ! empty( $provider_instance->nlu_features ) ) {
			$nlu_features = $provider_instance->nlu_features;
		}

		foreach ( $post_types as $post_type ) {
			$post_type_options[ $post_type->name ] = $post_type->label;
		}

		add_settings_field(
			'classification_mode',
			esc_html__( 'Classification mode', 'classifai' ),
			[ $this, 'render_radio_group' ],
			$this->get_option_name(),
			$this->get_option_name() . '_section',
			[
				'label_for'     => 'classification_mode',
				'default_value' => $settings['classification_mode'],
				'options'       => array(
					'manual_review'            => __( 'Manual review', 'classifai' ),
					'automatic_classification' => __( 'Automatic classification', 'classifai' ),
				),
			]
		);

		$method_options = array(
			'recommended_terms' => __( 'Recommend terms even if they do not exist on the site', 'classifai' ),
			'existing_terms'    => __( 'Only recommend terms that already exist on the site', 'classifai' ),
		);

		// Embeddings only supports existing terms.
		if ( isset( $settings['provider'] ) &amp;&amp; Embeddings::ID === $settings['provider'] ) {
			unset( $method_options['recommended_terms'] );
			$settings['classification_method'] = 'existing_terms';
		}

		add_settings_field(
			'classification_method',
			esc_html__( 'Classification method', 'classifai' ),
			[ $this, 'render_radio_group' ],
			$this->get_option_name(),
			$this->get_option_name() . '_section',
			[
				'label_for'     => 'classification_method',
				'default_value' => $settings['classification_method'],
				'options'       => $method_options,
			]
		);

		foreach ( $nlu_features as $classify_by => $labels ) {
			add_settings_field(
				$classify_by,
				esc_html( $labels['feature'] ),
				[ $this, 'render_nlu_feature_settings' ],
				$this->get_option_name(),
				$this->get_option_name() . '_section',
				[
					'feature'       => $classify_by,
					'labels'        => $labels,
					'default_value' => $settings[ $classify_by ],
					'post_types'    => $settings['post_types'],
				]
			);
		}

		add_settings_field(
			'post_statuses',
			esc_html__( 'Post statuses', 'classifai' ),
			[ $this, 'render_checkbox_group' ],
			$this->get_option_name(),
			$this->get_option_name() . '_section',
			[
				'label_for'      => 'post_statuses',
				'options'        => $post_statuses,
				'default_values' => $settings['post_statuses'],
				'description'    => __( 'Choose which post statuses are allowed to use this feature.', 'classifai' ),
			]
		);

		add_settings_field(
			'post_types',
			esc_html__( 'Post types', 'classifai' ),
			[ $this, 'render_checkbox_group' ],
			$this->get_option_name(),
			$this->get_option_name() . '_section',
			[
				'label_for'      => 'post_types',
				'options'        => $post_type_options,
				'default_values' => $settings['post_types'],
				'description'    => __( 'Choose which post types are allowed to use this feature.', 'classifai' ),
			]
		);
	}

	/**
	 * Returns the default settings for the feature.
	 *
	 * @return array
	 */
	public function get_feature_default_settings(): array {
		return [
			'post_statuses'         => [
				'publish' => 1,
			],
			'post_types'            => [
				'post' => 1,
			],
			'classification_mode'   => 'manual_review',
			'classification_method' => 'recommended_terms',
			'provider'              => NLU::ID,
		];
	}

	/**
	 * Sanitizes the default feature settings.
	 *
	 * @param array $new_settings Settings being saved.
	 * @return array
	 */
	public function sanitize_default_feature_settings( array $new_settings ): array {
		$settings          = $this->get_settings();
		$provider_instance = $this->get_feature_provider_instance();

		$new_settings['classification_mode'] = sanitize_text_field( $new_settings['classification_mode'] ?? $settings['classification_mode'] );

		$new_settings['classification_method'] = sanitize_text_field( $new_settings['classification_method'] ?? $settings['classification_method'] );

		// Embeddings only supports existing terms.
		if ( isset( $new_settings['provider'] ) &amp;&amp; Embeddings::ID === $new_settings['provider'] ) {
			$new_settings['classification_method'] = 'existing_terms';
		}

		$new_settings['post_statuses'] = isset( $new_settings['post_statuses'] ) ? array_map( 'sanitize_text_field', $new_settings['post_statuses'] ) : $settings['post_statuses'];

		$new_settings['post_types'] = isset( $new_settings['post_types'] ) ? array_map( 'sanitize_text_field', $new_settings['post_types'] ) : $settings['post_types'];

		if ( ! empty( $provider_instance->nlu_features ) ) {
			foreach ( array_keys( $provider_instance->nlu_features ) as $feature_name ) {
				$new_settings[ $feature_name ]               = absint( $new_settings[ $feature_name ] ?? $settings[ $feature_name ] );
				$new_settings[ "{$feature_name}_threshold" ] = absint( $new_settings[ "{$feature_name}_threshold" ] ?? $settings[ "{$feature_name}_threshold" ] );
				$new_settings[ "{$feature_name}_taxonomy" ]  = sanitize_text_field( $new_settings[ "{$feature_name}_taxonomy" ] ?? $settings[ "{$feature_name}_taxonomy" ] );
			}
		}

		return $new_settings;
	}

	/**
	 * Get all feature taxonomies.
	 *
	 * @return array
	 */
	public function get_all_feature_taxonomies(): array {
		$feature_taxonomies = [];
		$provider_instance  = $this->get_feature_provider_instance();

		if ( empty( $provider_instance->nlu_features ) ) {
			return $feature_taxonomies;
		}

		foreach ( array_keys( $provider_instance->nlu_features ) as $feature_name ) {
			if ( ! get_classification_feature_enabled( $feature_name ) ) {
				continue;
			}

			$taxonomy   = get_classification_feature_taxonomy( $feature_name );
			$permission = check_term_permissions( $taxonomy );

			if ( is_wp_error( $permission ) ) {
				continue;
			}

			if ( 'post_tag' === $taxonomy ) {
				$taxonomy = 'tags';
			}

			if ( 'category' === $taxonomy ) {
				$taxonomy = 'categories';
			}

			$feature_taxonomies[] = $taxonomy;
		}

		return $feature_taxonomies;
	}

	/**
	 * Render the NLU features settings.
	 *
	 * @param array $args Settings for the inputs
	 */
	public function render_nlu_feature_settings( array $args ) {
		$feature = $args['feature'];
		$labels  = $args['labels'];

		$taxonomies = $this->get_supported_taxonomies( $args['post_types'] );
		$features   = $this->get_settings();
		$taxonomy   = isset( $features[ "{$feature}_taxonomy" ] ) ? $features[ "{$feature}_taxonomy" ] : $labels['taxonomy_default'];

		// Enable classification type
		$feature_args = [
			'label_for'  => $feature,
			'input_type' => 'checkbox',
		];

		$threshold_args = [
			'label_for'     => "{$feature}_threshold",
			'input_type'    => 'number',
			'default_value' => $labels['threshold_default'],
		];
		?>

		&lt;legend class="screen-reader-text">
			&lt;?php esc_html_e( 'Classification Taxonomy Settings', 'classifai' ); ?>
		&lt;/legend>

		&lt;p>
			&lt;?php $this->render_input( $feature_args ); ?>
			&lt;label for="&lt;?php echo esc_attr( $feature ); ?>">
				&lt;?php esc_html_e( 'Enable', 'classifai' ); ?>
			&lt;/label>
		&lt;/p>

		&lt;p>
			&lt;label for="&lt;?php echo esc_attr( "{$feature}_threshold" ); ?>">
				&lt;?php echo esc_html( $labels['threshold'] ); ?>
			&lt;/label>&lt;br/>
			&lt;?php $this->render_input( $threshold_args ); ?>
		&lt;/p>

		&lt;?php if ( NLU::ID === $features['provider'] ) : ?>
		&lt;p>
			&lt;label for="classifai-settings-&lt;?php echo esc_attr( "{$feature}_taxonomy" ); ?>">
				&lt;?php echo esc_html( $labels['taxonomy'] ); ?>
			&lt;/label>&lt;br/>
			&lt;select id="classifai-settings-&lt;?php echo esc_attr( "{$feature}_taxonomy" ); ?>" name="&lt;?php echo esc_attr( $this->get_option_name() ); ?>[&lt;?php echo esc_attr( "{$feature}_taxonomy" ); ?>]">
				&lt;?php foreach ( $taxonomies as $name => $singular_name ) : ?>
					&lt;option value="&lt;?php echo esc_attr( $name ); ?>" &lt;?php selected( $taxonomy, esc_attr( $name ) ); ?>>
						&lt;?php echo esc_html( $singular_name ); ?>
					&lt;/option>
				&lt;?php endforeach; ?>
			&lt;/select>
		&lt;/p>
		&lt;?php endif; ?>
		&lt;?php
	}

	/**
	 * Return the list of supported taxonomies
	 *
	 * @param array $post_types Array of supported post types.
	 * @return array
	 */
	public function get_supported_taxonomies( array $post_types = [] ): array {
		$supported_post_types = [];

		if ( ! empty( $post_types ) ) {
			foreach ( $post_types as $post_type => $enabled ) {
				if ( ! empty( $enabled ) ) {
					$supported_post_types[] = $post_type;
				}
			}
		}

		$taxonomies = get_taxonomies( [], 'objects' );
		$taxonomies = array_filter( $taxonomies, 'is_taxonomy_viewable' );
		$supported  = [];

		foreach ( $taxonomies as $taxonomy ) {
			// Remove this taxonomy if it doesn't support at least one of our post types.
			if (
				(
					! empty( $supported_post_types ) &amp;&amp;
					empty( array_intersect( $supported_post_types, $taxonomy->object_type ) )
				) ||
				'post_format' === $taxonomy->name
			) {
				continue;
			}

			$supported[ $taxonomy->name ] = $taxonomy->labels->singular_name;
		}

		/**
		 * Filter taxonomies shown in settings.
		 *
		 * @since 3.0.0
		 * @hook classifai_feature_classification_setting_taxonomies
		 *
		 * @param {array} $supported Array of supported taxonomies.
		 * @param {object} $this Current instance of the class.
		 *
		 * @return {array} Array of taxonomies.
		 */
		return apply_filters( 'classifai_' . static::ID . '_setting_taxonomies', $supported, $this );
	}

	/**
	 * Generates feature setting data required for migration from
	 * ClassifAI &lt; 3.0.0 to 3.0.0
	 *
	 * @return array
	 */
	public function migrate_settings() {
		$old_settings = get_option( 'classifai_watson_nlu', array() );
		$new_settings = $this->get_default_settings();

		if ( isset( $old_settings['authenticated'] ) &amp;&amp; $old_settings['authenticated'] ) {
			$new_settings['provider'] = 'ibm_watson_nlu';

			// Status
			if ( isset( $old_settings['enable_content_classification'] ) ) {
				$new_settings['status'] = $old_settings['enable_content_classification'];
			}

			// Post types
			if ( isset( $old_settings['post_types'] ) ) {
				if ( is_array( $old_settings['post_types'] ) ) {
					foreach ( $old_settings['post_types'] as $post_type => $value ) {
						if ( 1 === $value ) {
							$new_settings['post_types'][ $post_type ] = $post_type;
							continue;
						} elseif ( is_null( $value ) ) {
							$new_settings['post_types'][ $post_type ] = '0';
							continue;
						}
						$new_settings['post_types'][ $post_type ] = $value;
					}
				}

				unset( $new_settings['post_types']['attachment'] );
			}

			// Post statuses
			if ( isset( $old_settings['post_statuses'] ) ) {
				if ( is_array( $old_settings['post_statuses'] ) ) {
					foreach ( $old_settings['post_statuses'] as $post_status => $value ) {
						if ( 1 === $value ) {
							$new_settings['post_statuses'][ $post_status ] = $post_status;
							continue;
						} elseif ( is_null( $value ) ) {
							$new_settings['post_statuses'][ $post_status ] = '0';
							continue;
						}
						$new_settings['post_statuses'][ $post_status ] = $value;
					}
				}
			}

			// Roles
			if ( isset( $old_settings['content_classification_roles'] ) ) {
				$new_settings['roles'] = $old_settings['content_classification_roles'];
			}

			// Users
			if ( isset( $old_settings['content_classification_users'] ) ) {
				$new_settings['users'] = $old_settings['content_classification_users'];
			}

			// Provider.
			if ( isset( $old_settings['credentials'] ) &amp;&amp; isset( $old_settings['credentials']['watson_url'] ) ) {
				$new_settings['ibm_watson_nlu']['endpoint_url'] = $old_settings['credentials']['watson_url'];
			}

			if ( isset( $old_settings['credentials'] ) &amp;&amp; isset( $old_settings['credentials']['watson_username'] ) ) {
				$new_settings['ibm_watson_nlu']['username'] = $old_settings['credentials']['watson_username'];
			}

			if ( isset( $old_settings['credentials'] ) &amp;&amp; isset( $old_settings['credentials']['watson_password'] ) ) {
				$new_settings['ibm_watson_nlu']['password'] = $old_settings['credentials']['watson_password'];
			}

			if ( isset( $old_settings['classification_mode'] ) ) {
				$new_settings['classification_mode'] = $old_settings['classification_mode'];
			}

			if ( isset( $old_settings['classification_method'] ) ) {
				$new_settings['classification_method'] = $old_settings['classification_method'];
			}

			if ( isset( $old_settings['features'] ) ) {
				foreach ( $old_settings['features'] as $feature => $value ) {
					$new_settings[ $feature ] = $value;
				}
			}

			if ( isset( $old_settings['authenticated'] ) ) {
				$new_settings['ibm_watson_nlu']['authenticated'] = $old_settings['authenticated'];
			}

			if ( isset( $old_settings['content_classification_user_based_opt_out'] ) ) {
				$new_settings['user_based_opt_out'] = $old_settings['content_classification_user_based_opt_out'];
			}
		} else {
			$old_settings = get_option( 'classifai_openai_embeddings', array() );

			if ( isset( $old_settings['enable_classification'] ) ) {
				$new_settings['status'] = $old_settings['enable_classification'];
			}

			$new_settings['provider'] = 'openai_embeddings';

			if ( isset( $old_settings['api_key'] ) ) {
				$new_settings['openai_embeddings']['api_key'] = $old_settings['api_key'];
			}

			if ( isset( $old_settings['taxonomies'] ) ) {
				foreach ( $old_settings['taxonomies'] as $feature => $value ) {
					$new_settings[ $feature ] = $value;
				}
			}

			if ( isset( $old_settings['authenticated'] ) ) {
				$new_settings['openai_embeddings']['authenticated'] = $old_settings['authenticated'];
			}

			if ( isset( $old_settings['post_statuses'] ) ) {
				$new_settings['post_statuses'] = $old_settings['post_statuses'];
			}

			if ( isset( $old_settings['post_types'] ) ) {
				$new_settings['post_types'] = $old_settings['post_types'];
			}

			if ( isset( $old_settings['classification_roles'] ) ) {
				$new_settings['roles'] = $old_settings['classification_roles'];
			}

			if ( isset( $old_settings['classification_users'] ) ) {
				$new_settings['users'] = $old_settings['classification_users'];
			}

			if ( isset( $old_settings['classification_user_based_opt_out'] ) ) {
				$new_settings['user_based_opt_out'] = $old_settings['classification_user_based_opt_out'];
			}
		}

		return $new_settings;
	}
}
</code></pre>
        </article>
    </section>





    <footer>
		<a href="https://classifaiplugin.com/">ClassifAI Plugin</a> &bull;
		<a href="https://github.com/10up/classifai/">ClassifAI on GitHub</a> &bull;
		<a href="https://10up.com/careers">Careers at 10up</a>
	</footer>


</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Actions</h3><ul><li><a href="after_classifai_init.html">after_classifai_init</a></li><li><a href="before_classifai_init.html">before_classifai_init</a></li><li><a href="classifai_after_feature_settings_form.html">classifai_after_feature_settings_form</a></li><li><a href="classifai_azure_read_after_request.html">classifai_azure_read_after_request</a></li><li><a href="classifai_before_feature_nav.html">classifai_before_feature_nav</a></li><li><a href="classifai_before_feature_settings_form.html">classifai_before_feature_settings_form</a></li><li><a href="classifai_computer_vision_caption_failed.html">classifai_computer_vision_caption_failed</a></li><li><a href="classifai_computer_vision_image_tag_failed.html">classifai_computer_vision_image_tag_failed</a></li><li><a href="classifai_ms_computer_vision_render_provider_fields.html">classifai_ms_computer_vision_render_provider_fields</a></li><li><a href="classifai_ocr_after_request.html">classifai_ocr_after_request</a></li><li><a href="classifai_ocr_unsuccessful_response.html">classifai_ocr_unsuccessful_response</a></li><li><a href="classifai_render_attachment_metabox.html">classifai_render_attachment_metabox</a></li><li><a href="classifai_smart_cropping_after_request.html">classifai_smart_cropping_after_request</a></li><li><a href="classifai_smart_cropping_unsuccessful_response.html">classifai_smart_cropping_unsuccessful_response</a></li></ul><h3>Filters</h3><ul><li><a href="classifai_all_post_statuses.html">classifai_all_post_statuses</a></li><li><a href="classifai_audio_generation_initial_state.html">classifai_audio_generation_initial_state</a></li><li><a href="classifai_audio_generation_subsequent_state.html">classifai_audio_generation_subsequent_state</a></li><li><a href="classifai_azure_openai_content.html">classifai_azure_openai_content</a></li><li><a href="classifai_azure_openai_excerpt_prompt.html">classifai_azure_openai_excerpt_prompt</a></li><li><a href="classifai_azure_openai_excerpt_request_body.html">classifai_azure_openai_excerpt_request_body</a></li><li><a href="classifai_azure_openai_resize_content_request_body.html">classifai_azure_openai_resize_content_request_body</a></li><li><a href="classifai_azure_openai_title_prompt.html">classifai_azure_openai_title_prompt</a></li><li><a href="classifai_azure_openai_title_request_body.html">classifai_azure_openai_title_request_body</a></li><li><a href="classifai_azure_read_request_args.html">classifai_azure_read_request_args</a></li><li><a href="classifai_azure_read_result_max_page.html">classifai_azure_read_result_max_page</a></li><li><a href="classifai_azure_read_retry_interval.html">classifai_azure_read_retry_interval</a></li><li><a href="classifai_azure_read_should_process.html">classifai_azure_read_should_process</a></li><li><a href="classifai_azure_read_text_result.html">classifai_azure_read_text_result</a></li><li><a href="classifai_chatgpt_content.html">classifai_chatgpt_content</a></li><li><a href="classifai_chatgpt_excerpt_prompt.html">classifai_chatgpt_excerpt_prompt</a></li><li><a href="classifai_chatgpt_excerpt_request_body.html">classifai_chatgpt_excerpt_request_body</a></li><li><a href="classifai_chatgpt_resize_content_request_body.html">classifai_chatgpt_resize_content_request_body</a></li><li><a href="classifai_chatgpt_title_prompt.html">classifai_chatgpt_title_prompt</a></li><li><a href="classifai_chatgpt_title_request_body.html">classifai_chatgpt_title_request_body</a></li><li><a href="classifai_classified_data.html">classifai_classified_data</a></li><li><a href="classifai_computer_vision_captions.html">classifai_computer_vision_captions</a></li><li><a href="classifai_computer_vision_image_tags.html">classifai_computer_vision_image_tags</a></li><li><a href="classifai_computer_vision_max_filesize.html">classifai_computer_vision_max_filesize</a></li><li><a href="classifai_dalle_caption.html">classifai_dalle_caption</a></li><li><a href="classifai_dalle_prompt.html">classifai_dalle_prompt</a></li><li><a href="classifai_dalle_request_body.html">classifai_dalle_request_body</a></li><li><a href="classifai_debug_information.html">classifai_debug_information</a></li><li><a href="classifai_disable_post_to_audio_block.html">classifai_disable_post_to_audio_block</a></li><li><a href="classifai_feature_classification_setting_taxonomies.html">classifai_feature_classification_setting_taxonomies</a></li><li><a href="classifai_feature_classification_taxonomy_for_feature.html">classifai_feature_classification_taxonomy_for_feature</a></li><li><a href="classifai_feature_image_generation_roles.html">classifai_feature_image_generation_roles</a></li><li><a href="classifai_feature_pdf_to_text_generation_read_status.html">classifai_feature_pdf_to_text_generation_read_status</a></li><li><a href="classifai_feature_threshold.html">classifai_feature_threshold</a></li><li><a href="classifai_generate_image_alt_tags_source_url.html">classifai_generate_image_alt_tags_source_url</a></li><li><a href="classifai_googleai_api_request_get_options.html">classifai_googleai_api_request_get_options</a></li><li><a href="classifai_googleai_api_request_get_url.html">classifai_googleai_api_request_get_url</a></li><li><a href="classifai_googleai_api_request_post_options.html">classifai_googleai_api_request_post_options</a></li><li><a href="classifai_googleai_api_request_post_url.html">classifai_googleai_api_request_post_url</a></li><li><a href="classifai_googleai_api_response_get.html">classifai_googleai_api_response_get</a></li><li><a href="classifai_googleai_api_response_post.html">classifai_googleai_api_response_post</a></li><li><a href="classifai_googleai_content.html">classifai_googleai_content</a></li><li><a href="classifai_googleai_gemini_api_excerpt_prompt.html">classifai_googleai_gemini_api_excerpt_prompt</a></li><li><a href="classifai_googleai_gemini_api_excerpt_request_body.html">classifai_googleai_gemini_api_excerpt_request_body</a></li><li><a href="classifai_googleai_gemini_api_resize_content_request_body.html">classifai_googleai_gemini_api_resize_content_request_body</a></li><li><a href="classifai_googleai_gemini_api_title_prompt.html">classifai_googleai_gemini_api_title_prompt</a></li><li><a href="classifai_googleai_gemini_api_title_request_body.html">classifai_googleai_gemini_api_title_request_body</a></li><li><a href="classifai_image_processing_service_providers.html">classifai_image_processing_service_providers</a></li><li><a href="classifai_language_processing_service_providers.html">classifai_language_processing_service_providers</a></li><li><a href="classifai_language_settings_post_statuses.html">classifai_language_settings_post_statuses</a></li><li><a href="classifai_language_settings_post_types.html">classifai_language_settings_post_types</a></li><li><a href="classifai_listen_to_this_post_text.html">classifai_listen_to_this_post_text</a></li><li><a href="classifai_normalize.html">classifai_normalize</a></li><li><a href="classifai_ocr_approved_media_types.html">classifai_ocr_approved_media_types</a></li><li><a href="classifai_ocr_should_process.html">classifai_ocr_should_process</a></li><li><a href="classifai_ocr_tag_confidence.html">classifai_ocr_tag_confidence</a></li><li><a href="classifai_ocr_tags.html">classifai_ocr_tags</a></li><li><a href="classifai_ocr_text.html">classifai_ocr_text</a></li><li><a href="classifai_ocr_text_post_args.html">classifai_ocr_text_post_args</a></li><li><a href="classifai_openai_api_request_get_options.html">classifai_openai_api_request_get_options</a></li><li><a href="classifai_openai_api_request_get_url.html">classifai_openai_api_request_get_url</a></li><li><a href="classifai_openai_api_request_post_form_options.html">classifai_openai_api_request_post_form_options</a></li><li><a href="classifai_openai_api_request_post_form_url.html">classifai_openai_api_request_post_form_url</a></li><li><a href="classifai_openai_api_request_post_options.html">classifai_openai_api_request_post_options</a></li><li><a href="classifai_openai_api_request_post_url.html">classifai_openai_api_request_post_url</a></li><li><a href="classifai_openai_api_response_get.html">classifai_openai_api_response_get</a></li><li><a href="classifai_openai_api_response_post.html">classifai_openai_api_response_post</a></li><li><a href="classifai_openai_api_response_post_form.html">classifai_openai_api_response_post_form</a></li><li><a href="classifai_openai_characters_in_token.html">classifai_openai_characters_in_token</a></li><li><a href="classifai_openai_embeddings_content.html">classifai_openai_embeddings_content</a></li><li><a href="classifai_openai_embeddings_request_body.html">classifai_openai_embeddings_request_body</a></li><li><a href="classifai_openai_embeddings_should_classify.html">classifai_openai_embeddings_should_classify</a></li><li><a href="classifai_openai_moderation_request_body.html">classifai_openai_moderation_request_body</a></li><li><a href="classifai_openai_settings_post_statuses.html">classifai_openai_settings_post_statuses</a></li><li><a href="classifai_openai_settings_post_types.html">classifai_openai_settings_post_types</a></li><li><a href="classifai_openai_settings_taxonomies.html">classifai_openai_settings_taxonomies</a></li><li><a href="classifai_openai_tokens_per_word.html">classifai_openai_tokens_per_word</a></li><li><a href="classifai_pre_render_post_audio_controls.html">classifai_pre_render_post_audio_controls</a></li><li><a href="classifai_recommendation_service_providers.html">classifai_recommendation_service_providers</a></li><li><a href="classifai_recommended_block_attributes.html">classifai_recommended_block_attributes</a></li><li><a href="classifai_recommended_block_markup.html">classifai_recommended_block_markup</a></li><li><a href="classifai_recommended_content_post_args.html">classifai_recommended_content_post_args</a></li><li><a href="classifai_services.html">classifai_services</a></li><li><a href="classifai_should_classify_post.html">classifai_should_classify_post</a></li><li><a href="classifai_should_crop_size.html">classifai_should_crop_size</a></li><li><a href="classifai_should_ocr_scan_image.html">classifai_should_ocr_scan_image</a></li><li><a href="classifai_should_smart_crop_image.html">classifai_should_smart_crop_image</a></li><li><a href="classifai_smart_crop_max_pixel_dimension.html">classifai_smart_crop_max_pixel_dimension</a></li><li><a href="classifai_smart_crop_wp_filesystem.html">classifai_smart_crop_wp_filesystem</a></li><li><a href="classifai_smart_cropping_source_url.html">classifai_smart_cropping_source_url</a></li><li><a href="classifai_smart_cropping_thumb_file_name.html">classifai_smart_cropping_thumb_file_name</a></li><li><a href="classifai_threshold.html">classifai_threshold</a></li><li><a href="classifai_whisper_transcribe_request_body.html">classifai_whisper_transcribe_request_body</a></li><li><a href="classifai_whisper_transcribe_result.html">classifai_whisper_transcribe_result</a></li><li><a href="classifai_%257B$feature%257D_has_access.html">classifai_{$feature}_has_access</a></li><li><a href="classifai_%257B$feature%257D_is_enabled.html">classifai_{$feature}_is_enabled</a></li><li><a href="classifai_%257B$feature%257D_is_feature_enabled.html">classifai_{$feature}_is_feature_enabled</a></li><li><a href="classifai_%257B$feature%257D_sanitize_settings.html">classifai_{$feature}_sanitize_settings</a></li><li><a href="classifai_%257Bfeature%257D_debug_information.html">classifai_{feature}_debug_information</a></li><li><a href="classifai_%257Bfeature%257D_get_default_settings.html">classifai_{feature}_get_default_settings</a></li><li><a href="classifai_%257Bfeature%257D_label.html">classifai_{feature}_label</a></li><li><a href="classifai_%257Bfeature%257D_post_statuses.html">classifai_{feature}_post_statuses</a></li><li><a href="classifai_%257Bfeature%257D_post_types.html">classifai_{feature}_post_types</a></li><li><a href="classifai_%257Bfeature%257D_providers.html">classifai_{feature}_providers</a></li><li><a href="classifai_%257Bfeature%257D_rest_route_%257Broute%257D_args.html">classifai_{feature}_rest_route_{route}_args</a></li><li><a href="classifai_%257Bfeature%257D_roles.html">classifai_{feature}_roles</a></li><li><a href="classifai_%257Bfeature%257D_run.html">classifai_{feature}_run</a></li><li><a href="%257B$this-_menu_slug%257D_features.html">{$this->menu_slug}_features</a></li><li><a href="%257B$this-_menu_slug%257D_providers.html">{$this->menu_slug}_providers</a></li></ul><h3>Tutorials</h3><ul><li><a href="tutorial-migration-guide-v2-to-v3.html">Migration guide (version 2 to version 3)</a></li><li><a href="tutorial-useful-snippets.html">Useful snippets</a></li><li><a href="tutorial-wp-cli.html">WP-CLI commands</a></li></ul>
</nav>

<br class="clear">

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
