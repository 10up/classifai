(()=>{"use strict";function e(e){document.querySelectorAll(`#${e} .classifai-send-reward`).forEach((function(e){e.addEventListener("click",(function(e){var t;e.preventDefault();const n=this.getAttribute("data-eventid"),r=this.getAttribute("data-rewarded"),a=`${null===(t=classifai_personalizer_params)||void 0===t?void 0:t.reward_endpoint}`;fetch(a.replace("{eventId}",n),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({rewarded:r})}).catch((e=>{console.error(e)})),window.location=this.href}))}))}document.addEventListener("DOMContentLoaded",(function(){document.querySelectorAll(".classifai-recommended-block-wrap").forEach((function(t){var n,r;const a=t.getAttribute("id"),o=function(e){const t=window.sessionStorage.getItem(e);if(null!==t){const e=JSON.parse(t);if(new Date(e.expiresAt)>new Date)return e.value}return null}(a);if(null!==o)return t.innerHTML=o,void e(a);const i=t.getAttribute("data-attr_key"),c=null===(n=classifai_personalizer_params)||void 0===n?void 0:n.ajax_url,s=JSON.parse(document.getElementById(`attributes-${i}`).textContent);s.action="classifai_render_recommended_content",s.security=null===(r=classifai_personalizer_params)||void 0===r?void 0:r.ajax_nonce;const d=new URLSearchParams(s);s.taxQuery&&Object.keys(s.taxQuery)&&(d.delete("taxQuery"),Object.keys(s.taxQuery).forEach((e=>{s.taxQuery[e]&&s.taxQuery[e].forEach((t=>{d.append(`taxQuery[${e}][]`,t)}))}))),fetch(c,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},body:d}).then((e=>{if(!e.ok)throw new Error("Something went wrong");return e.text()})).then((t=>{var n,r;t&&(n=a,r=t,60,window.sessionStorage.setItem(n,JSON.stringify({expiresAt:new Date((new Date).getTime()+36e5),value:r}))),document.getElementById(a).innerHTML=t,e(a)})).catch((e=>{document.getElementById(a).innerHTML="",console.error(e)}))}))}))})();