(()=>{"use strict";const{__}=wp.i18n,{get:t}=window.lodash,e=e=>{let{button:a,endpoint:n,callback:s=!1,buttonText:i=__("Rescan","classifai")}=e;const d=a.getAttribute("data-id"),[c]=a.parentNode.getElementsByClassName("spinner"),[l]=a.parentNode.getElementsByClassName("error"),o=`${n}${d}`;a.setAttribute("disabled","disabled"),c.style.display="inline-block",c.classList.add("is-active"),l.style.display="none",wp.apiRequest({path:o}).then((t=>{a.removeAttribute("disabled"),c.style.display="none",c.classList.remove("is-active"),a.textContent=i,s&&s(t)}),(e=>{const n=t(e,"responseJSON",{code:"unknown_error",message:__("An unknown error occurred.","classifai")});c.style.display="none",c.classList.remove("is-active"),a.removeAttribute("disabled"),a.textContent=i,l.style.display="inline-block",l.textContent=`Error: ${n.message}`}))};!function(t){const{__}=wp.i18n,a=()=>{const t=document.getElementById("classifai-rescan-alt-tags"),a=document.getElementById("classifai-rescan-image-tags"),n=document.getElementById("classifai-rescan-ocr"),s=document.getElementById("classifai-rescan-smart-crop"),i=document.getElementById("classifai-rescan-pdf");t&&t.addEventListener("click",(t=>e({button:t.target,endpoint:"/classifai/v1/alt-tags/",callback:t=>{const{enabledAltTextFields:e}=classifaiMediaVars;if(t){if(e.includes("alt")){var a;const e=null!==(a=document.getElementById("attachment-details-two-column-alt-text"))&&void 0!==a?a:document.getElementById("attachment-details-alt-text");e&&(e.value=t)}if(e.includes("caption")){var n;const e=null!==(n=document.getElementById("attachment-details-two-column-caption"))&&void 0!==n?n:document.getElementById("attachment-details-caption");e&&(e.value=t)}if(e.includes("description")){var s;const e=null!==(s=document.getElementById("attachment-details-two-column-description"))&&void 0!==s?s:document.getElementById("attachment-details-description");e&&(e.value=t)}}}}))),a&&a.addEventListener("click",(t=>e({button:t.target,endpoint:"/classifai/v1/image-tags/"}))),n&&n.addEventListener("click",(t=>e({button:t.target,endpoint:"/classifai/v1/ocr/",callback:t=>{if(t){var e;const a=null!==(e=document.getElementById("attachment-details-two-column-description"))&&void 0!==e?e:document.getElementById("attachment-details-description");a&&(a.value=t)}}}))),s&&s.addEventListener("click",(t=>e({button:t.target,endpoint:"/classifai/v1/smart-crop/"}))),i&&i.addEventListener("click",(t=>{const e=t.target.getAttribute("data-id");wp.apiRequest({path:`/classifai/v1/read-pdf/${e}`}),t.target.setAttribute("disabled","disabled"),t.target.textContent=__("Read API requested!","classifai")}))},n=()=>{const e=document.getElementById("classifai-rescan-pdf");if(!e)return;const a=e.getAttribute("data-id");t.ajax({url:ajaxurl,type:"POST",data:{action:"classifai_get_read_status",attachment_id:a,nonce:ClassifAI.ajax_nonce},success:t=>{t?.success&&(t?.data?.running?(e.setAttribute("disabled","disabled"),e.textContent=__("In progress!","classifai")):t?.data?.read&&(e.textContent=__("Rescan","classifai")))}})};t(document).ready((function(){wp.media&&wp.media.view.Modal.prototype.on("open",(function(){wp.media.frame.on("selection:toggle",a),wp.media.frame.on("selection:toggle",n)})),wp.media.frame&&(wp.media.frame.on("edit:attachment",a),wp.media.frame.on("edit:attachment",n)),wp.Uploader&&wp.Uploader.queue&&wp.Uploader.queue.on("reset",a)}))}(jQuery)})();