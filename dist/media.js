(()=>{"use strict";const{__}=wp.i18n,{get:e}=window.lodash,t=t=>{let{button:a,endpoint:n,callback:s=!1,buttonText:i=__("Rescan","classifai")}=t;const d=a.getAttribute("data-id"),[l]=a.parentNode.getElementsByClassName("spinner"),[o]=a.parentNode.getElementsByClassName("error"),c=`${n}${d}`;a.setAttribute("disabled","disabled"),l.style.display="inline-block",l.classList.add("is-active"),o.style.display="none",wp.apiRequest({path:c}).then((e=>{a.removeAttribute("disabled"),l.style.display="none",l.classList.remove("is-active"),a.textContent=i,s&&s(e)}),(t=>{const n=e(t,"responseJSON",{code:"unknown_error",message:__("An unknown error occurred.","classifai")});l.style.display="none",l.classList.remove("is-active"),a.removeAttribute("disabled"),a.textContent=i,o.style.display="inline-block",o.textContent=`Error: ${n.message}`}))};!function(e){const{__}=wp.i18n,a=()=>{const e=document.getElementById("classifai-rescan-alt-tags"),a=document.getElementById("classifai-rescan-image-tags"),n=document.getElementById("classifai-rescan-ocr"),s=document.getElementById("classifai-rescan-smart-crop"),i=document.getElementById("classifai-rescan-pdf");e&&e.addEventListener("click",(e=>t({button:e.target,endpoint:"/classifai/v1/alt-tags/",callback:e=>{if(e){var t;const a=null!==(t=document.getElementById("attachment-details-two-column-alt-text"))&&void 0!==t?t:document.getElementById("attachment-details-alt-text");a&&(a.value=e)}}}))),a&&a.addEventListener("click",(e=>t({button:e.target,endpoint:"/classifai/v1/image-tags/"}))),n&&n.addEventListener("click",(e=>t({button:e.target,endpoint:"/classifai/v1/ocr/",callback:e=>{if(e){var t;const a=null!==(t=document.getElementById("attachment-details-two-column-description"))&&void 0!==t?t:document.getElementById("attachment-details-description");a&&(a.value=e)}}}))),s&&s.addEventListener("click",(e=>t({button:e.target,endpoint:"/classifai/v1/smart-crop/"}))),i&&i.addEventListener("click",(e=>{const t=e.target.getAttribute("data-id");wp.apiRequest({path:`/classifai/v1/read-pdf/${t}`}),e.target.setAttribute("disabled","disabled"),e.target.textContent=__("Read API requested!","classifai")}))};e(document).ready((function(){wp.media&&wp.media.view.Modal.prototype.on("open",(function(){wp.media.frame.on("selection:toggle",a)})),wp.media.frame&&wp.media.frame.on("edit:attachment",a),wp.Uploader&&wp.Uploader.queue&&wp.Uploader.queue.on("reset",a)}))}(jQuery)})();