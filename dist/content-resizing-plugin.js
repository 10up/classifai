(()=>{"use strict";const e=window.React,t=window.wp.plugins,n=window.wp.blockEditor,i=window.wp.editor,s=window.wp.data,a=window.wp.element,c=window.wp.dom,r=window.wp.compose,l=window.wp.components,o=window.wp.wordcount,d=window.wp.i18n,u=({feature:t})=>t&&ClassifAI?.opt_out_enabled_features?.includes(t)?(0,e.createElement)(l.Button,{href:ClassifAI?.profile_url,variant:"link",className:"classifai-disable-feature-link",target:"_blank",rel:"noopener noreferrer",label:(0,d.__)("Opt out of using this ClassifAI feature","classifai"),text:(0,d.__)("Disable this ClassifAI feature","classifai")}):null,p=(window.wp.coreData,window.wp.apiFetch,window.wp.url,(0,e.createElement)("svg",{width:"20",height:"15",viewBox:"0 0 61 46",fill:"none",xmlns:"http://www.w3.org/2000/svg"},(0,e.createElement)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3.51922 0C1.57575 0 0 1.5842 0 3.53846V42.4615C0 44.4158 1.57575 46 3.51922 46H57.4808C59.4243 46 61 44.4158 61 42.4615V3.53846C61 1.5842 59.4243 0 57.4808 0H3.51922ZM16.709 8.13836H21.4478L33.58 39.5542H27.524L24.0318 30.5144H13.9699L10.5169 39.5542H4.55669L16.709 8.13836ZM19.0894 16.7007C18.9846 17.041 18.878 17.3735 18.7702 17.698L18.7582 17.7344L15.9976 25.1398H22.1464L19.4013 17.6851L19.0894 16.7007ZM40.3164 8.13836H52.9056V12.1528L49.4929 12.9715V34.6306L52.9056 35.41V39.4338H40.3164V35.41L43.7291 34.6306V12.9715L40.3164 12.1528V8.13836Z"}))),g={clientId:"",resizingType:null,isResizing:!1},m=(0,s.createReduxStore)("resize-content-store",{reducer(e=g,t){switch(t.type){case"SET_CLIENT_ID":return{...e,clientId:t.clientId};case"SET_RESIZING_TYPE":return{...e,resizingType:t.resizingType};case"SET_IS_RESIZING":return{...e,isResizing:t.isResizing}}return e},actions:{setClientId:e=>({type:"SET_CLIENT_ID",clientId:e}),setResizingType:e=>({type:"SET_RESIZING_TYPE",resizingType:e}),setIsResizing:e=>({type:"SET_IS_RESIZING",isResizing:e})},selectors:{getClientId:e=>e.clientId,getResizingType:e=>e.resizingType,getIsResizing:e=>e.isResizing}});(0,s.register)(m);const _=({count:t=0,countEntity:n="word"})=>0===t?(0,e.createElement)("div",null,"word"===n?(0,d.__)("No change in word count.","classifai"):(0,d.__)("No change in character count.","classifai")):t<0?(0,e.createElement)("div",{className:"classifai-content-resize__shrink-stat"},"word"===n?(0,e.createElement)(e.Fragment,null,(0,e.createElement)("strong",null,t)," ",(0,d.__)("words","classifai")):(0,e.createElement)(e.Fragment,null,(0,e.createElement)("strong",null,t)," ",(0,d.__)("characters","classifai"))):(0,e.createElement)("div",{className:"classifai-content-resize__grow-stat"},"word"===n?(0,e.createElement)(e.Fragment,null,(0,e.createElement)("strong",null,"+",t)," ",(0,d.__)("words","classifai")):(0,e.createElement)(e.Fragment,null,(0,e.createElement)("strong",null,"+",t)," ",(0,d.__)("characters","classifai")));function w(e){return e=e.replace(/<br>/g,"\n"),(0,c.__unstableStripHTML)(e).trim().replace(/\n\n+/g,"\n\n")}(0,t.registerPlugin)("tenup-openai-expand-reduce-content",{render:()=>{const[t,c]=(0,a.useState)(""),[r,p]=(0,a.useState)(null),[g,f]=(0,a.useState)([]),[E,h]=(0,a.useState)(!1),{isMultiBlocksSelected:I,resizingType:z,isResizing:y}=(0,s.useSelect)((e=>({isMultiBlocksSelected:e(n.store).hasMultiSelection(),resizingType:e(m).getResizingType(),isResizing:e(m).getIsResizing()})));function S(){p(null),f([]),h(!1),(0,s.dispatch)(m).setResizingType(null)}return(0,a.useEffect)((()=>{z&&(async()=>{await async function(){var e;const t=(0,s.select)(n.store).getSelectedBlock(),i=null!==(e=t.attributes.content)&&void 0!==e?e:"";p(t),c(w(i)),(0,s.dispatch)(m).setIsResizing(!0)}()})()}),[z]),(0,a.useEffect)((()=>{y&&r&&(async()=>{const e=await async function(){let e=[];const n=`${wpApiSettings.root}classifai/v1/resize-content`,a=(0,s.select)(i.store).getCurrentPostId(),c=new FormData;c.append("id",a),c.append("content",t),c.append("resize_type",z),(0,s.dispatch)(m).setClientId(r.clientId);const l=await fetch(n,{method:"POST",body:c,headers:new Headers({"X-WP-Nonce":wpApiSettings.nonce})});return 200===l.status?e=await l.json():((0,s.dispatch)(m).setIsResizing(!1),(0,s.dispatch)(m).setClientId(""),S()),(0,s.dispatch)(m).setIsResizing(!1),(0,s.dispatch)(m).setClientId(""),e}();f(e),h(!0)})()}),[y,r]),I||y?null:!y&&g.length&&E&&(0,e.createElement)(l.Modal,{title:(0,d.__)("Select a suggestion","classifai"),isFullScreen:!1,className:"classifai-content-resize__suggestion-modal",onRequestClose:()=>{h(!1),S()}},(0,e.createElement)("div",{className:"classifai-content-resize__result-wrapper"},(0,e.createElement)("table",{className:"classifai-content-resize__result-table"},(0,e.createElement)("thead",null,(0,e.createElement)("tr",null,(0,e.createElement)("th",null,(0,d.__)("Suggestion","classifai")),(0,e.createElement)("th",{className:"classifai-content-resize__stat-header"},(0,d.__)("Stats","classifai")),(0,e.createElement)("th",null,(0,d.__)("Action","classifai")))),(0,e.createElement)("tbody",null,g.map(((i,a)=>{const c=(0,o.count)(t,"words"),u=(0,o.count)(t,"characters_including_spaces"),p=(0,o.count)(i,"words")-c,g=(0,o.count)(i,"characters_including_spaces")-u;return(0,e.createElement)("tr",{key:a},(0,e.createElement)("td",null,i),(0,e.createElement)("td",null,(0,e.createElement)(_,{count:p}),(0,e.createElement)(_,{count:g,countEntity:"character"})),(0,e.createElement)("td",null,(0,e.createElement)(l.Button,{text:(0,d.__)("Select","classifai"),variant:"secondary",onClick:()=>async function(e){const t=await(0,s.select)("core/editor").isEditedPostDirty(),i=(0,s.select)("core/editor").getCurrentPostId(),a=(0,s.select)("core/editor").getCurrentPostType();(0,s.dispatch)(n.store).updateBlockAttributes(r.clientId,{content:e}),(0,s.dispatch)(n.store).selectionChange(r.clientId,"content",0,e.length),S(),t||await(0,s.dispatch)("core").saveEditedEntityRecord("postType",a,i)}(i),tabIndex:"0"})))}))))),(0,e.createElement)(u,{feature:"feature_content_resizing"}))}});const f=["#8c2525","#ca4444","#303030"];let E=0;function h(e="",t){if(!t)return;if(!(0,s.select)(m).getIsResizing())return void clearTimeout(E);const n=e.split(" "),i=function(e=[],t=10){const n=Array.from({length:e.length},((e,t)=>t)),i=[];for(;i.length<t;){const e=Math.floor(Math.random()*n.length);i.includes(e)||i.push(e)}return i}(n,n.length/4),a=n.map(((e,t)=>{if(i.includes(t)){const t=Math.floor(5*Math.random());return`<span class="classifai-content-resize__blot" style="background-color: ${f[t]}">${e}</span>`}return e}));t.current.innerHTML=a.join(" "),E=setTimeout((()=>{requestAnimationFrame((()=>h(e,t)))}),1e3/1.35)}const I=(0,r.createHigherOrderComponent)((t=>n=>{const{currentClientId:i}=(0,s.useSelect)((e=>({currentClientId:e(m).getClientId()}))),c=(0,a.useRef)();if(i!==n.clientId)return(0,e.createElement)(t,{...n});if("core/paragraph"!==n.name)return(0,e.createElement)(t,{...n});const r=w(n.attributes.content);return(0,s.select)(m).getIsResizing()&&requestAnimationFrame((()=>h(r,c))),(0,e.createElement)(e.Fragment,null,(0,e.createElement)("div",{style:{position:"relative"}},(0,e.createElement)("div",{className:"classifai-content-resize__overlay"},(0,e.createElement)("div",{className:"classifai-content-resize__overlay-text"},(0,d.__)("Processing dataâ€¦","classifai"))),(0,e.createElement)("div",{id:"classifai-content-resize__mock-content",ref:c},r),(0,e.createElement)(t,{...n})))}),"withInspectorControl");wp.hooks.addFilter("editor.BlockEdit","resize-content/lock-block-editing",I);const z=(0,r.createHigherOrderComponent)((t=>i=>{const{isMultiBlocksSelected:a,resizingType:c}=(0,s.useSelect)((e=>({isMultiBlocksSelected:e(n.store).hasMultiSelection(),currentClientId:e(m).getClientId(),resizingType:e(m).getResizingType()})));return"core/paragraph"!==i.name?(0,e.createElement)(t,{...i}):(0,e.createElement)(e.Fragment,null,c||a?null:(0,e.createElement)(n.BlockControls,{group:"other"},(0,e.createElement)(l.ToolbarDropdownMenu,{icon:p,className:"classifai-resize-content-btn",controls:[{title:(0,d.__)("Expand this text","classifai"),onClick:()=>{(0,s.dispatch)(m).setResizingType("grow")}},{title:(0,d.__)("Condense this text","classifai"),onClick:()=>{(0,s.dispatch)(m).setResizingType("shrink")}}]})),(0,e.createElement)(t,{...i}))}),"withBlockControl");wp.hooks.addFilter("editor.BlockEdit","resize-content/lock-block-editing",z)})();