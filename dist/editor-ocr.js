(()=>{"use strict";const e=window.wp.element,{select:t,dispatch:c,subscribe:n}=wp.data,{createBlock:o}=wp.blocks,{apiFetch:i}=wp,{find:r,debounce:a}=lodash,{addFilter:l}=wp.hooks,{createHigherOrderComponent:s}=wp.compose,{BlockControls:d}=wp.blockEditor,{Button:p,Modal:m,Flex:u,FlexItem:f,ToolbarGroup:b,ToolbarButton:g}=wp.components,{__}=wp.i18n,{useState:h,Fragment:k}=wp.element,y=(0,e.createElement)("span",{className:"dashicons dashicons-editor-paste-text"}),x=async(e,n,i)=>{if(!i)return;const{getBlockIndex:r}=t("core/block-editor"),a=o("core/group",{anchor:`classifai-ocr-${n}`,className:"is-style-classifai-ocr-text"}),l=o("core/paragraph",{content:i});await c("core/block-editor").insertBlock(a,r(e)+1),c("core/block-editor").insertBlock(l,0,a.clientId)},E=function(e){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(0===c.length){const{getBlocks:e}=t("core/block-editor");c=e()}return!!r(c,(t=>t.attributes.anchor===`classifai-ocr-${e}`))};l("editor.BlockEdit","classifai/image-processing-ocr",s((t=>c=>{const[n,o]=h(!1),{attributes:r,clientId:a,isSelected:l,name:s,setAttributes:w}=c;return l&&"core/image"==s?(!r.ocrChecked&&r.id&&(async e=>{const t=await i({path:`/wp/v2/media/${e}`});return!(!Object.prototype.hasOwnProperty.call(t,"classifai_has_ocr")||!t.classifai_has_ocr)&&!!(Object.prototype.hasOwnProperty.call(t,"description")&&Object.prototype.hasOwnProperty.call(t.description,"rendered")&&t.description.rendered)&&t.description.rendered.replace(/(<([^>]+)>)/gi,"").replace(/(\r\n|\n|\r)/gm,"").trim()})(r.id).then((e=>{e?(w({ocrScannedText:e,ocrChecked:!0}),o(!0)):w({ocrChecked:!0})})),(0,e.createElement)(k,null,(0,e.createElement)(t,c),r.ocrScannedText&&(0,e.createElement)(d,null,(0,e.createElement)(b,null,(0,e.createElement)(g,{label:__("Insert scanned text into content","classifai"),icon:y,onClick:()=>x(a,r.id,r.ocrScannedText),disabled:E(r.id)}))),n&&(0,e.createElement)(m,{title:__("ClassifAI detected text in your image","classifai")},(0,e.createElement)("p",null,__("Would you like to insert the scanned text under this image block? This enhances search indexing and accessibility for your readers.","classifai")),(0,e.createElement)(u,{align:"flex-end",justify:"flex-end"},(0,e.createElement)(f,null,(0,e.createElement)(p,{isPrimary:!0,onClick:()=>{x(a,r.id,r.ocrScannedText),o(!1)}},__("Insert text","classifai"))),(0,e.createElement)(f,null,(0,e.createElement)(p,{isSecondary:!0,onClick:()=>o(!1)},__("Dismiss","classifai"))))))):(0,e.createElement)(t,c)}),"imageOcrControl")),l("blocks.registerBlockType","classifai/image-processing-ocr",((e,t)=>("core/image"!==t||e.attributes&&(e.attributes.ocrScannedText={type:"string",default:""},e.attributes.ocrChecked={type:"boolean",default:!1}),e))),wp.blocks.registerBlockStyle("core/group",{name:"classifai-ocr-text",label:__("Scanned Text from Image","classifai")});{let e,c=[];n(a((()=>{const n=t("core/block-editor"),o=n.getSelectedBlock(),a=n.getBlocks();if(null===o)return l(),void(e=o);if(o!==e&&!c.includes(o.clientId))if(l(),e=o,"core/image"===o.name){const e=r(a,(e=>e.attributes.anchor===`classifai-ocr-${o.attributes.id}`));void 0!==e&&i([e.clientId,o.clientId])}else{const e=n.getBlock(n.getBlockHierarchyRootClientId(o.clientId));if("core/group"===e.name){let t=/classifai-ocr-([0-9]+)/.exec(e.attributes.anchor);if(null!==t){[,t]=t;const c=r(a,(e=>e.attributes.id==t));void 0!==c&&i([c.clientId,e.clientId])}}}}),100));const o=()=>{const e=document.head||document.getElementsByTagName("head")[0],t=document.createElement("style");return t.setAttribute("id","classifai-ocr-style"),e.appendChild(t),t},i=e=>{var t;const n=null!==(t=document.getElementById("classifai-ocr-style"))&&void 0!==t?t:o(),i=`${e.map((e=>`#block-${e}:before`)).join(", ")} {\n\t\t\tcontent: "";\n\t\t\tposition: absolute;\n\t\t\tdisplay: block;\n\t\t\ttop: 0;\n\t\t\tleft: -15px;\n\t\t\tbottom: 0;\n\t\t\tborder-left: 4px solid #cfe7f3;\n\t\t\tmix-blend-mode: difference;\n\t\t\topacity: 0.25;\n\t\t}`;n.appendChild(document.createTextNode(i)),c=e},l=()=>{if(0===c.length)return;const e=document.getElementById("classifai-ocr-style");e&&(e.innerText=""),c=[]}}})();