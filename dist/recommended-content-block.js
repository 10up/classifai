(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var l in n)e.o(n,l)&&!e.o(t,l)&&Object.defineProperty(t,l,{enumerable:!0,get:n[l]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.i18n,n=window.wp.blocks,l=window.wp.element,a=window.wp.components,o=window.wp.blockEditor,s=window.wp.primitives,r=(0,l.createElement)(s.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},(0,l.createElement)(s.Path,{d:"M4 4v1.5h16V4H4zm8 8.5h8V11h-8v1.5zM4 20h16v-1.5H4V20zm4-8c0-1.1-.9-2-2-2s-2 .9-2 2 .9 2 2 2 2-.9 2-2z"})),i=(0,l.createElement)(s.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,l.createElement)(s.Path,{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7.8 16.5H5c-.3 0-.5-.2-.5-.5v-6.2h6.8v6.7zm0-8.3H4.5V5c0-.3.2-.5.5-.5h6.2v6.7zm8.3 7.8c0 .3-.2.5-.5.5h-6.2v-6.8h6.8V19zm0-7.8h-6.8V4.5H19c.3 0 .5.2.5.5v6.2z",fillRule:"evenodd",clipRule:"evenodd"})),c=window.wp.data,d=window.wp.serverSideRender;var u=e.n(d);const m=window.wp.coreData,p=e=>{const t=null==e?void 0:e.reduce(((e,t)=>{const{mapById:n,mapByName:l,names:a}=e;return n[t.id]=t,l[t.name]=t,a.push(t.name),e}),{mapById:{},mapByName:{},names:[]});return{entities:e,...t}},g=e=>{let{onChange:t,query:n}=e;const o=(s=n.contentPostType,(0,c.useSelect)((e=>{const{getTaxonomies:t}=e(m.store);return t({type:s,per_page:-1,context:"view"})}),[s]));var s;const r=(0,c.useSelect)((e=>{const{getEntityRecords:t}=e(m.store),n={per_page:100};return null==o?void 0:o.map((e=>{let{slug:l,name:a}=e;const o=t("taxonomy",l,n);return{slug:l,name:a,terms:p(o)}}))}),[o]),i=e=>{var t;const l=r.find((t=>{let{slug:n}=t;return n===e}));return l?((null===(t=n.taxQuery)||void 0===t?void 0:t[e])||[]).reduce(((e,t)=>{const n=l.terms.mapById[t];return n&&e.push({id:t,value:n.name}),e}),[]):[]};return(0,l.createElement)(l.Fragment,null,!(null==r||!r.length)&&r.map((e=>{var o;let{slug:s,name:c,terms:d}=e;return null!=d&&null!==(o=d.names)&&void 0!==o&&o.length?(0,l.createElement)(a.FormTokenField,{key:s,label:c,value:i(s),suggestions:d.names,onChange:(u=s,e=>{const l=r.find((e=>{let{slug:t}=e;return t===u}));if(!l)return;const a=Array.from(e.reduce(((e,t)=>{const n=((e,t)=>{var n;const l=(null==t?void 0:t.id)||(null===(n=e[t])||void 0===n?void 0:n.id);if(l)return l;const a=t.toLocaleLowerCase();for(const t in e)if(t.toLocaleLowerCase()===a)return e[t].id})(l.terms.mapByName,t);return n&&e.add(n),e}),new Set)),o={...n.taxQuery,[u]:a};t({taxQuery:o})})}):null;var u})))},y=JSON.parse('{"u2":"classifai/recommended-content-block"}'),v=window.React;var h;function w(){return w=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&(e[l]=n[l])}return e},w.apply(this,arguments)}(0,n.registerBlockType)(y.u2,{title:(0,t.__)("Recommended Content","classifai"),description:(0,t.__)("Display content recommended by Azure Personalizer","classifai"),edit:e=>{const{attributes:n,setAttributes:s}=e,{columns:d=3,displayLayout:p="grid",numberOfItems:y=3,contentPostType:v,taxQuery:h,displayAuthor:w,displayFeaturedImage:f,displayPostDate:_,displayPostExcerpt:b,addLinkToFeaturedImage:C}=n,E=(0,c.useSelect)((e=>e("core/editor").getCurrentPostId())),P=(0,o.useBlockProps)(),{postTypesTaxonomiesMap:x,postTypesSelectOptions:k}=(()=>{const e=(0,c.useSelect)((e=>{var t;const{getPostTypes:n}=e(m.store),l=["attachment"];return null===(t=n({per_page:-1}))||void 0===t?void 0:t.filter((e=>{let{viewable:t,slug:n}=e;return t&&!l.includes(n)}))}),[]);return{postTypesTaxonomiesMap:(0,l.useMemo)((()=>{if(null!=e&&e.length)return e.reduce(((e,t)=>(e[t.slug]=t.taxonomies,e)),{})}),[e]),postTypesSelectOptions:(0,l.useMemo)((()=>(e||[]).map((e=>{let{labels:t,slug:n}=e;return{label:t.singular_name,value:n}}))),[e])}})(),T=[{icon:r,title:(0,t.__)("List view","classifai"),onClick:()=>s({displayLayout:"list"}),isActive:"list"===p},{icon:i,title:(0,t.__)("Grid view"),onClick:()=>s({displayLayout:"grid"}),isActive:"grid"===p}];return(0,l.createElement)("div",P,(0,l.createElement)(o.BlockControls,null,(0,l.createElement)(a.ToolbarGroup,{controls:T})),(0,l.createElement)(o.InspectorControls,null,(0,l.createElement)(a.PanelBody,{title:(0,t.__)("Recommended Content Filters","classifai")},k&&(0,l.createElement)(a.SelectControl,{label:(0,t.__)("Post type","classifai"),value:v,options:k,onChange:e=>{const t={contentPostType:e},n=x[e],l=Object.entries(h||{}).reduce(((e,t)=>{let[l,a]=t;return n.includes(l)&&(e[l]=a),e}),{});t.taxQuery=Object.keys(l).length?l:void 0,s(t)}}),k&&(0,l.createElement)(g,{onChange:s,query:n})),(0,l.createElement)(a.PanelBody,{title:(0,t.__)("Settings","classifai")},(0,l.createElement)(a.RangeControl,{label:(0,t.__)("Number of items","classifai"),value:y,onChange:e=>s({numberOfItems:e}),min:1,max:50,required:!0}),"grid"===p&&(0,l.createElement)(a.RangeControl,{label:(0,t.__)("Columns","classifai"),value:d,onChange:e=>s({columns:e}),min:2,max:6,required:!0})),(0,l.createElement)(a.PanelBody,{title:(0,t.__)("Post content settings","classifai")},(0,l.createElement)(a.ToggleControl,{label:(0,t.__)("Post excerpt","classifai"),checked:b,onChange:e=>s({displayPostExcerpt:e})})),(0,l.createElement)(a.PanelBody,{title:(0,t.__)("Post meta settings","classifai")},(0,l.createElement)(a.ToggleControl,{label:(0,t.__)("Display author name","classifai"),checked:w,onChange:e=>s({displayAuthor:e})}),(0,l.createElement)(a.ToggleControl,{label:(0,t.__)("Display post date","classifai"),checked:_,onChange:e=>s({displayPostDate:e})})),(0,l.createElement)(a.PanelBody,{title:(0,t.__)("Featured image settings","classifai")},(0,l.createElement)(a.ToggleControl,{label:(0,t.__)("Display featured image","classifai"),checked:f,onChange:e=>s({displayFeaturedImage:e})}),f&&(0,l.createElement)(a.ToggleControl,{label:(0,t.__)("Add link to featured image","classifai"),checked:C,onChange:e=>s({addLinkToFeaturedImage:e})}))),!v&&(0,l.createElement)(a.Placeholder,{label:(0,t.__)("ClassifAI Recommended Content","classifai")},(0,l.createElement)("p",null,(0,t.__)("Please select Post type for this Recommended Content block on the sidebar settings.","classifai"))),v&&(0,l.createElement)(u(),{block:"classifai/recommended-content-block",attributes:{addLinkToFeaturedImage:C,columns:d,contentPostType:v,displayAuthor:w,displayFeaturedImage:f,displayLayout:p,displayPostDate:_,displayPostExcerpt:b,numberOfItems:y,taxQuery:h,excludeId:E||0}}))},save:()=>null,icon:function(e){return v.createElement("svg",w({width:20,height:15,viewBox:"0 0 61 46",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),h||(h=v.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3.52 0C1.575 0 0 1.584 0 3.538v38.924C0 44.416 1.576 46 3.52 46h53.96c1.944 0 3.52-1.584 3.52-3.538V3.538C61 1.584 59.424 0 57.48 0H3.52Zm13.189 8.138h4.739L33.58 39.554h-6.056l-3.492-9.04H13.97l-3.453 9.04h-5.96L16.709 8.138Zm2.38 8.563c-.104.34-.211.672-.319.997l-.012.036-2.76 7.406h6.148l-2.745-7.455-.312-.984Zm21.227-8.563h12.59v4.015l-3.413.819V34.63l3.413.779v4.024h-12.59V35.41l3.413-.78V12.972l-3.413-.818V8.138Z",fill:"#1e1e1e"})))}})})();