(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var a in n)e.o(n,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:n[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.i18n,n=window.wp.blocks,a=window.React,l=window.wp.components,o=window.wp.blockEditor,s=window.wp.primitives,r=(0,a.createElement)(s.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},(0,a.createElement)(s.Path,{d:"M4 4v1.5h16V4H4zm8 8.5h8V11h-8v1.5zM4 20h16v-1.5H4V20zm4-8c0-1.1-.9-2-2-2s-2 .9-2 2 .9 2 2 2 2-.9 2-2z"})),i=(0,a.createElement)(s.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,a.createElement)(s.Path,{d:"m3 5c0-1.10457.89543-2 2-2h13.5c1.1046 0 2 .89543 2 2v13.5c0 1.1046-.8954 2-2 2h-13.5c-1.10457 0-2-.8954-2-2zm2-.5h6v6.5h-6.5v-6c0-.27614.22386-.5.5-.5zm-.5 8v6c0 .2761.22386.5.5.5h6v-6.5zm8 0v6.5h6c.2761 0 .5-.2239.5-.5v-6zm0-8v6.5h6.5v-6c0-.27614-.2239-.5-.5-.5z",fillRule:"evenodd",clipRule:"evenodd"})),c=window.wp.data,d=window.wp.serverSideRender;var m=e.n(d);const u=window.wp.coreData,p=window.wp.element,g=e=>{const t=e?.reduce(((e,t)=>{const{mapById:n,mapByName:a,names:l}=e;return n[t.id]=t,a[t.name]=t,l.push(t.name),e}),{mapById:{},mapByName:{},names:[]});return{entities:e,...t}},y=({onChange:e,query:t})=>{const n=(o=t.contentPostType,(0,c.useSelect)((e=>{const{getTaxonomies:t}=e(u.store);return t({type:o,per_page:-1,context:"view"})}),[o]));var o;const s=(0,c.useSelect)((e=>{const{getEntityRecords:t}=e(u.store),a={per_page:100},l=n?.map((({slug:e,name:n})=>{const l=t("taxonomy",e,a);return{slug:e,name:n,terms:g(l)}}));return l}),[n]),r=e=>{const n=s.find((({slug:t})=>t===e));return n?(t.taxQuery?.[e]||[]).reduce(((e,t)=>{const a=n.terms.mapById[t];return a&&e.push({id:t,value:a.name}),e}),[]):[]};return(0,a.createElement)(a.Fragment,null,!!s?.length&&s.map((({slug:n,name:o,terms:i})=>{return i?.names?.length?(0,a.createElement)(l.FormTokenField,{key:n,label:o,value:r(n),suggestions:i.names,onChange:(c=n,n=>{const a=s.find((({slug:e})=>e===c));if(!a)return;const l=Array.from(n.reduce(((e,t)=>{const n=((e,t)=>{const n=t?.id||e[t]?.id;if(n)return n;const a=t.toLocaleLowerCase();for(const t in e)if(t.toLocaleLowerCase()===a)return e[t].id})(a.terms.mapByName,t);return n&&e.add(n),e}),new Set)),o={...t.taxQuery,[c]:l};e({taxQuery:o})})}):null;var c})))},h=JSON.parse('{"UU":"classifai/recommended-content-block"}');var w;function v(){return v=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},v.apply(this,arguments)}(0,n.registerBlockType)(h.UU,{title:(0,t.__)("Recommended Content","classifai"),description:(0,t.__)("Display content recommended by Azure AI Personalizer","classifai"),edit:e=>{const{attributes:n,setAttributes:s}=e,{columns:d=3,displayLayout:g="grid",numberOfItems:h=3,contentPostType:w,taxQuery:v,displayAuthor:f,displayFeaturedImage:_,displayPostDate:b,displayPostExcerpt:C,addLinkToFeaturedImage:E}=n,P=(0,c.useSelect)((e=>e("core/editor").getCurrentPostId())),x=(0,o.useBlockProps)(),{postTypesTaxonomiesMap:k,postTypesSelectOptions:T}=(()=>{const e=(0,c.useSelect)((e=>{const{getPostTypes:t}=e(u.store),n=["attachment"],a=t({per_page:-1})?.filter((({viewable:e,slug:t})=>e&&!n.includes(t)));return a}),[]);return{postTypesTaxonomiesMap:(0,p.useMemo)((()=>{if(e?.length)return e.reduce(((e,t)=>(e[t.slug]=t.taxonomies,e)),{})}),[e]),postTypesSelectOptions:(0,p.useMemo)((()=>(e||[]).map((({labels:e,slug:t})=>({label:e.singular_name,value:t})))),[e])}})(),I=[{icon:r,title:(0,t.__)("List view","classifai"),onClick:()=>s({displayLayout:"list"}),isActive:"list"===g},{icon:i,title:(0,t.__)("Grid view"),onClick:()=>s({displayLayout:"grid"}),isActive:"grid"===g}],{hasRecommendedContentAccess:B}=window;return B?(0,a.createElement)("div",{...x},(0,a.createElement)(o.BlockControls,null,(0,a.createElement)(l.ToolbarGroup,{controls:I})),(0,a.createElement)(o.InspectorControls,null,(0,a.createElement)(l.PanelBody,{title:(0,t.__)("Recommended Content Filters","classifai")},T&&(0,a.createElement)(l.SelectControl,{label:(0,t.__)("Post type","classifai"),value:w,options:T,onChange:e=>{const t={contentPostType:e},n=k[e],a=Object.entries(v||{}).reduce(((e,[t,a])=>(n.includes(t)&&(e[t]=a),e)),{});t.taxQuery=Object.keys(a).length?a:void 0,s(t)}}),T&&(0,a.createElement)(y,{onChange:s,query:n})),(0,a.createElement)(l.PanelBody,{title:(0,t.__)("Settings","classifai")},(0,a.createElement)(l.RangeControl,{label:(0,t.__)("Number of items","classifai"),value:h,onChange:e=>s({numberOfItems:e}),min:1,max:50,required:!0}),"grid"===g&&(0,a.createElement)(l.RangeControl,{label:(0,t.__)("Columns","classifai"),value:d,onChange:e=>s({columns:e}),min:2,max:6,required:!0})),(0,a.createElement)(l.PanelBody,{title:(0,t.__)("Post content settings","classifai")},(0,a.createElement)(l.ToggleControl,{label:(0,t.__)("Post excerpt","classifai"),checked:C,onChange:e=>s({displayPostExcerpt:e})})),(0,a.createElement)(l.PanelBody,{title:(0,t.__)("Post meta settings","classifai")},(0,a.createElement)(l.ToggleControl,{label:(0,t.__)("Display author name","classifai"),checked:f,onChange:e=>s({displayAuthor:e})}),(0,a.createElement)(l.ToggleControl,{label:(0,t.__)("Display post date","classifai"),checked:b,onChange:e=>s({displayPostDate:e})})),(0,a.createElement)(l.PanelBody,{title:(0,t.__)("Featured image settings","classifai")},(0,a.createElement)(l.ToggleControl,{label:(0,t.__)("Display featured image","classifai"),checked:_,onChange:e=>s({displayFeaturedImage:e})}),_&&(0,a.createElement)(l.ToggleControl,{label:(0,t.__)("Add link to featured image","classifai"),checked:E,onChange:e=>s({addLinkToFeaturedImage:e})}))),!w&&(0,a.createElement)(l.Placeholder,{label:(0,t.__)("ClassifAI Recommended Content","classifai")},(0,a.createElement)("p",null,(0,t.__)("Please select Post type for this Recommended Content block on the sidebar settings.","classifai"))),w&&(0,a.createElement)(m(),{block:"classifai/recommended-content-block",attributes:{addLinkToFeaturedImage:E,columns:d,contentPostType:w,displayAuthor:f,displayFeaturedImage:_,displayLayout:g,displayPostDate:b,displayPostExcerpt:C,numberOfItems:h,taxQuery:v,excludeId:P||0}})):(0,a.createElement)(l.Placeholder,{label:(0,t.__)("ClassifAI Recommended Content","classifai")},(0,a.createElement)("p",null,(0,t.__)("You don't have access to the Recommended Content block. Please contact the administrator to request access.","classifai")))},save:()=>null,icon:function(e){return a.createElement("svg",v({xmlns:"http://www.w3.org/2000/svg",width:20,height:15,fill:"none",viewBox:"0 0 61 46"},e),w||(w=a.createElement("path",{fill:"#1e1e1e",fillRule:"evenodd",d:"M3.52 0C1.575 0 0 1.584 0 3.538v38.924C0 44.416 1.576 46 3.52 46h53.96c1.944 0 3.52-1.584 3.52-3.538V3.538C61 1.584 59.424 0 57.48 0zm13.189 8.138h4.739L33.58 39.554h-6.056l-3.492-9.04H13.97l-3.453 9.04h-5.96zm2.38 8.563q-.156.51-.319.997l-.012.036-2.76 7.406h6.148l-2.745-7.455zm21.227-8.563h12.59v4.015l-3.413.819V34.63l3.413.779v4.024h-12.59V35.41l3.413-.78V12.972l-3.413-.818z",clipRule:"evenodd"})))}})})();