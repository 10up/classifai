(()=>{"use strict";const e=window.wp.element,t=window.wp.i18n,n=window.wp.data,s=window.wp.editPost,r=window.wp.editor,a=window.wp.plugins,i=window.wp.components,o=window.wp.compose,{get:l}=lodash,c=(0,o.compose)([(0,n.withSelect)((e=>({excerpt:e("core/editor").getEditedPostAttribute("excerpt")}))),(0,n.withDispatch)((e=>({onUpdateExcerpt(t){e("core/editor").editPost({excerpt:t})}})))])((function({excerpt:n,onUpdateExcerpt:s}){const{select:r}=wp.data,a=r("core/editor").getCurrentPostId(),o=""===n?(0,t.__)("Generate excerpt","classifai"):(0,t.__)("Re-generate excerpt","classifai"),c=r("core/edit-post").isPublishSidebarOpened();return(0,e.createElement)("div",{className:"editor-post-excerpt"},(0,e.createElement)(i.TextareaControl,{__nextHasNoMarginBottom:!0,label:c?null:(0,t.__)("Write an excerpt (optional)"),className:"editor-post-excerpt__textarea",onChange:e=>s(e),value:n}),!c&&(0,e.createElement)(i.ExternalLink,{href:(0,t.__)("https://wordpress.org/support/article/settings-sidebar/#excerpt")},(0,t.__)("Learn more about manual excerpts")),(0,e.createElement)(i.Button,{variant:"secondary","data-id":a,onClick:e=>(({button:e,endpoint:n,callback:s=!1,buttonText:r=(0,t.__)("Rescan","classifai")})=>{const a=e.getAttribute("data-id"),[i]=e.parentNode.getElementsByClassName("spinner"),[o]=e.parentNode.getElementsByClassName("error"),c=`${n}${a}`;e.setAttribute("disabled","disabled"),i.style.display="inline-block",i.classList.add("is-active"),o.style.display="none",wp.apiRequest({path:c}).then((t=>{e.removeAttribute("disabled"),i.style.display="none",i.classList.remove("is-active"),e.textContent=r,s&&s(t)}),(n=>{const s=l(n,"responseJSON",{code:"unknown_error",message:(0,t.__)("An unknown error occurred.","classifai")});i.style.display="none",i.classList.remove("is-active"),e.removeAttribute("disabled"),e.textContent=r,o.style.display="inline-block",o.textContent=`Error: ${s.message}`}))})({button:e.target,endpoint:"/classifai/v1/openai/generate-excerpt/",callback:s,buttonText:o})},o),(0,e.createElement)("span",{className:"spinner",style:{display:"none",float:"none"}}),(0,e.createElement)("span",{className:"error",style:{display:"none",color:"#bc0b0b",paddingTop:"5px"}}))})),p=({children:n})=>{const r=[(0,t.__)("Suggestion:"),(0,e.createElement)("span",{className:"editor-post-publish-panel__link",key:"label"},(0,t.__)("Generate excerpt","classifai"))];return(0,e.createElement)(s.PluginPrePublishPanel,{title:r,icon:"aside",initialOpen:!0},n)};class d extends e.Component{constructor(e){super(e),this.state={hadExcerptWhenOpeningThePanel:""!==e.excerpt}}componentDidUpdate(e){this.props.isPublishPanelOpen&&e.isPublishPanelOpen!==this.props.isPublishPanelOpen&&this.setState({hadExcerptWhenOpeningThePanel:""!==this.props.excerpt})}render(){return this.state.hadExcerptWhenOpeningThePanel?null:(0,e.createElement)(p,null,this.props.children)}}const u=(0,n.withSelect)((e=>({excerpt:e("core/editor").getEditedPostAttribute("excerpt"),isPublishPanelOpen:e("core/edit-post").isPublishSidebarOpened()})))(d);(0,n.dispatch)("core/edit-post").removeEditorPanel("post-excerpt"),(0,a.registerPlugin)("post-excerpt",{render:()=>(0,e.createElement)(r.PostExcerptCheck,null,(0,e.createElement)(s.PluginDocumentSettingPanel,{title:(0,t.__)("Excerpt")},(0,e.createElement)(c,null)),(0,e.createElement)(u,null,(0,e.createElement)(c,null)))})})();