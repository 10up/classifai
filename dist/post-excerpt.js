(()=>{"use strict";const e=window.wp.element,t=window.wp.i18n,n=window.wp.data,s=window.wp.editPost,r=window.wp.editor,a=window.wp.plugins,i=window.wp.components,l=window.wp.compose,{get:o}=lodash,c=(0,l.compose)([(0,n.withSelect)((e=>({excerpt:e("core/editor").getEditedPostAttribute("excerpt")}))),(0,n.withDispatch)((e=>({onUpdateExcerpt(t){e("core/editor").editPost({excerpt:t})}})))])((function(n){let{excerpt:s,onUpdateExcerpt:r}=n;const{select:a}=wp.data,l=a("core/editor").getCurrentPostId(),c=""===s?(0,t.__)("Generate excerpt","classifai"):(0,t.__)("Re-generate excerpt","classifai"),p=a("core/edit-post").isPublishSidebarOpened();return(0,e.createElement)("div",{className:"editor-post-excerpt"},(0,e.createElement)(i.TextareaControl,{__nextHasNoMarginBottom:!0,label:p?null:(0,t.__)("Write an excerpt (optional)"),className:"editor-post-excerpt__textarea",onChange:e=>r(e),value:s}),!p&&(0,e.createElement)(i.ExternalLink,{href:(0,t.__)("https://wordpress.org/support/article/settings-sidebar/#excerpt")},(0,t.__)("Learn more about manual excerpts")),(0,e.createElement)(i.Button,{variant:"secondary","data-id":l,onClick:e=>(e=>{let{button:n,endpoint:s,callback:r=!1,buttonText:a=(0,t.__)("Rescan","classifai")}=e;const i=n.getAttribute("data-id"),[l]=n.parentNode.getElementsByClassName("spinner"),[c]=n.parentNode.getElementsByClassName("error"),p=`${s}${i}`;n.setAttribute("disabled","disabled"),l.style.display="inline-block",l.classList.add("is-active"),c.style.display="none",wp.apiRequest({path:p}).then((e=>{n.removeAttribute("disabled"),l.style.display="none",l.classList.remove("is-active"),n.textContent=a,r&&r(e)}),(e=>{const s=o(e,"responseJSON",{code:"unknown_error",message:(0,t.__)("An unknown error occurred.","classifai")});l.style.display="none",l.classList.remove("is-active"),n.removeAttribute("disabled"),n.textContent=a,c.style.display="inline-block",c.textContent=`Error: ${s.message}`}))})({button:e.target,endpoint:"/classifai/v1/openai/generate-excerpt/",callback:r,buttonText:c})},c),(0,e.createElement)("span",{className:"spinner",style:{display:"none",float:"none"}}),(0,e.createElement)("span",{className:"error",style:{display:"none",color:"#bc0b0b",paddingTop:"5px"}}))})),p=n=>{let{children:r}=n;const a=[(0,t.__)("Suggestion:"),(0,e.createElement)("span",{className:"editor-post-publish-panel__link",key:"label"},(0,t.__)("Generate excerpt","classifai"))];return(0,e.createElement)(s.PluginPrePublishPanel,{title:a,icon:"aside",initialOpen:!0},r)};class d extends e.Component{constructor(e){super(e),this.state={hadExcerptWhenOpeningThePanel:""!==e.excerpt}}componentDidUpdate(e){this.props.isPublishPanelOpen&&e.isPublishPanelOpen!==this.props.isPublishPanelOpen&&this.setState({hadExcerptWhenOpeningThePanel:""!==this.props.excerpt})}render(){return this.state.hadExcerptWhenOpeningThePanel?null:(0,e.createElement)(p,null,this.props.children)}}const u=(0,n.withSelect)((e=>({excerpt:e("core/editor").getEditedPostAttribute("excerpt"),isPublishPanelOpen:e("core/edit-post").isPublishSidebarOpened()})))(d);(0,n.dispatch)("core/edit-post").removeEditorPanel("post-excerpt"),(0,a.registerPlugin)("post-excerpt",{render:()=>(0,e.createElement)(r.PostExcerptCheck,null,(0,e.createElement)(s.PluginDocumentSettingPanel,{title:(0,t.__)("Excerpt")},(0,e.createElement)(c,null)),(0,e.createElement)(u,null,(0,e.createElement)(c,null)))})})();