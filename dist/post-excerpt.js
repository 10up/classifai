(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.element,n=window.wp.i18n,r=window.wp.data,a=window.wp.editPost,i=window.wp.editor,s=window.wp.plugins,o=window.wp.components,c=window.wp.compose,l=window.wp.apiFetch;var p=e.n(l);const d=(0,c.compose)([(0,r.withSelect)((e=>({excerpt:e("core/editor").getEditedPostAttribute("excerpt")}))),(0,r.withDispatch)((e=>({onUpdateExcerpt(t){e("core/editor").editPost({excerpt:t})}})))])((function({excerpt:e,onUpdateExcerpt:r}){const[a,i]=(0,t.useState)(!1),[s,c]=(0,t.useState)(!1),{select:l}=wp.data,d=l("core/editor").getCurrentPostId(),u=l("core/editor").getEditedPostAttribute("content"),h=l("core/editor").getEditedPostAttribute("title"),m=""===e?(0,n.__)("Generate excerpt","classifai"):(0,n.__)("Re-generate excerpt","classifai"),w=l("core/edit-post").isPublishSidebarOpened();return(0,t.createElement)("div",{className:"editor-post-excerpt"},(0,t.createElement)(o.TextareaControl,{__nextHasNoMarginBottom:!0,label:w?null:(0,n.__)("Write an excerpt (optional)"),className:"editor-post-excerpt__textarea",onChange:e=>r(e),value:e}),!w&&(0,t.createElement)(o.ExternalLink,{href:(0,n.__)("https://wordpress.org/support/article/settings-sidebar/#excerpt")},(0,n.__)("Learn more about manual excerpts")),(0,t.createElement)(o.Button,{className:"classifai-post-excerpt",variant:"secondary",disabled:a,"data-id":d,onClick:()=>(async e=>{i(!0),p()({path:"/classifai/v1/openai/generate-excerpt/",method:"POST",data:{id:d,content:u,title:h}}).then((e=>{r(e),c(!1),i(!1)}),(e=>{c(e?.message),i(!1)}))})()},m),a&&(0,t.createElement)("span",{className:"spinner is-active",style:{float:"none"}}),s&&!a&&(0,t.createElement)("span",{className:"error",style:{color:"#bc0b0b",display:"inline-block",paddingTop:"5px"}},s))})),u=({children:e})=>{const r=[(0,n.__)("Suggestion:"),(0,t.createElement)("span",{className:"editor-post-publish-panel__link",key:"label"},(0,n.__)("Generate excerpt","classifai"))];return(0,t.createElement)(a.PluginPrePublishPanel,{title:r,icon:"aside",initialOpen:!0},e)};class h extends t.Component{constructor(e){super(e),this.state={hadExcerptWhenOpeningThePanel:""!==e.excerpt}}componentDidUpdate(e){this.props.isPublishPanelOpen&&e.isPublishPanelOpen!==this.props.isPublishPanelOpen&&this.setState({hadExcerptWhenOpeningThePanel:""!==this.props.excerpt})}render(){return this.state.hadExcerptWhenOpeningThePanel?null:(0,t.createElement)(u,null,this.props.children)}}const m=(0,r.withSelect)((e=>({excerpt:e("core/editor").getEditedPostAttribute("excerpt"),isPublishPanelOpen:e("core/edit-post").isPublishSidebarOpened()})))(h);(0,r.dispatch)("core/edit-post").removeEditorPanel("post-excerpt"),(0,s.registerPlugin)("post-excerpt",{render:()=>(0,t.createElement)(i.PostExcerptCheck,null,(0,t.createElement)(a.PluginDocumentSettingPanel,{title:(0,n.__)("Excerpt")},(0,t.createElement)(d,null)),(0,t.createElement)(m,null,(0,t.createElement)(d,null)))})})();