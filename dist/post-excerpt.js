(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.React,n=window.wp.i18n,r=window.wp.data,a=window.wp.editPost,i=window.wp.editor,s=window.wp.plugins,o=window.wp.components,l=window.wp.compose,c=window.wp.element,p=window.wp.apiFetch;var d=e.n(p);const u=({feature:e})=>e&&ClassifAI?.opt_out_enabled_features?.includes(e)?(0,t.createElement)(o.Button,{href:ClassifAI?.profile_url,variant:"link",className:"classifai-disable-feature-link",target:"_blank",rel:"noopener noreferrer",label:(0,n.__)("Opt out of using this ClassifAI feature","classifai"),text:(0,n.__)("Disable this ClassifAI feature","classifai")}):null;window.wp.coreData,window.wp.url;const h=(0,l.compose)([(0,r.withSelect)((e=>({excerpt:e("core/editor").getEditedPostAttribute("excerpt")}))),(0,r.withDispatch)((e=>({onUpdateExcerpt(t){e("core/editor").editPost({excerpt:t})}})))])((function({excerpt:e,onUpdateExcerpt:r}){const[a,i]=(0,c.useState)(!1),[s,l]=(0,c.useState)(!1),{select:p}=wp.data,h=p("core/editor").getCurrentPostId(),w=p("core/editor").getEditedPostAttribute("content"),m=p("core/editor").getEditedPostAttribute("title"),x=""===e?(0,n.__)("Generate excerpt","classifai"):(0,n.__)("Re-generate excerpt","classifai"),_=p("core/edit-post").isPublishSidebarOpened();return(0,t.createElement)("div",{className:"editor-post-excerpt"},(0,t.createElement)(o.TextareaControl,{__nextHasNoMarginBottom:!0,label:_?null:(0,n.__)("Write an excerpt (optional)"),className:"editor-post-excerpt__textarea",onChange:e=>r(e),value:e}),!_&&(0,t.createElement)(o.ExternalLink,{href:(0,n.__)("https://wordpress.org/support/article/settings-sidebar/#excerpt")},(0,n.__)("Learn more about manual excerpts")),(0,t.createElement)(o.Button,{className:"classifai-post-excerpt",variant:"secondary",disabled:a,"data-id":h,onClick:()=>(async e=>{i(!0),d()({path:"/classifai/v1/openai/generate-excerpt/",method:"POST",data:{id:h,content:w,title:m}}).then((e=>{r(e),l(!1),i(!1)}),(e=>{l(e?.message),i(!1)}))})()},x),a&&(0,t.createElement)("span",{className:"spinner is-active",style:{float:"none"}}),s&&!a&&(0,t.createElement)("span",{className:"error",style:{color:"#bc0b0b",display:"inline-block",paddingTop:"5px"}},s),(0,t.createElement)(u,{feature:"excerpt_generation"}))})),w=({children:e})=>{const r=[(0,n.__)("Suggestion:"),(0,t.createElement)("span",{className:"editor-post-publish-panel__link",key:"label"},(0,n.__)("Generate excerpt","classifai"))];return(0,t.createElement)(a.PluginPrePublishPanel,{title:r,icon:"aside",initialOpen:!0},e)};class m extends c.Component{constructor(e){super(e),this.state={hadExcerptWhenOpeningThePanel:""!==e.excerpt}}componentDidUpdate(e){this.props.isPublishPanelOpen&&e.isPublishPanelOpen!==this.props.isPublishPanelOpen&&this.setState({hadExcerptWhenOpeningThePanel:""!==this.props.excerpt})}render(){return this.state.hadExcerptWhenOpeningThePanel?null:(0,t.createElement)(w,null,this.props.children)}}const x=(0,r.withSelect)((e=>({excerpt:e("core/editor").getEditedPostAttribute("excerpt"),isPublishPanelOpen:e("core/edit-post").isPublishSidebarOpened()})))(m);(0,r.dispatch)("core/edit-post").removeEditorPanel("post-excerpt"),(0,s.registerPlugin)("post-excerpt",{render:()=>(0,t.createElement)(i.PostExcerptCheck,null,(0,t.createElement)(a.PluginDocumentSettingPanel,{title:(0,n.__)("Excerpt")},(0,t.createElement)(h,null)),(0,t.createElement)(x,null,(0,t.createElement)(h,null)))})})();