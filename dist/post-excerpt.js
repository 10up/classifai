(()=>{"use strict";const e=window.wp.element,{__}=wp.i18n,{get:t}=window.lodash,{__:n}=wp.i18n,{Button:s,ExternalLink:a,TextareaControl:r}=wp.components,{withSelect:i,withDispatch:l}=wp.data,{compose:o}=wp.compose,p=o([i((e=>({excerpt:e("core/editor").getEditedPostAttribute("excerpt")}))),l((e=>({onUpdateExcerpt(t){e("core/editor").editPost({excerpt:t})}})))])((function(i){let{excerpt:l,onUpdateExcerpt:o}=i;const{select:p}=wp.data,c=p("core/editor").getCurrentPostId(),d=n(""===l?"Generate excerpt":"Re-generate excerpt","classifai"),u=p("core/edit-post").isPublishSidebarOpened();return(0,e.createElement)("div",{className:"editor-post-excerpt"},(0,e.createElement)(r,{__nextHasNoMarginBottom:!0,label:u?null:n("Write an excerpt (optional)"),className:"editor-post-excerpt__textarea",onChange:e=>o(e),value:l}),!u&&(0,e.createElement)(a,{href:n("https://wordpress.org/support/article/settings-sidebar/#excerpt")},n("Learn more about manual excerpts")),(0,e.createElement)(s,{variant:"secondary","data-id":c,onClick:e=>(e=>{let{button:n,endpoint:s,callback:a=!1,buttonText:r=__("Rescan","classifai")}=e;const i=n.getAttribute("data-id"),[l]=n.parentNode.getElementsByClassName("spinner"),[o]=n.parentNode.getElementsByClassName("error"),p=`${s}${i}`;n.setAttribute("disabled","disabled"),l.style.display="inline-block",l.classList.add("is-active"),o.style.display="none",wp.apiRequest({path:p}).then((e=>{n.removeAttribute("disabled"),l.style.display="none",l.classList.remove("is-active"),n.textContent=r,a&&a(e)}),(e=>{const s=t(e,"responseJSON",{code:"unknown_error",message:__("An unknown error occurred.","classifai")});l.style.display="none",l.classList.remove("is-active"),n.removeAttribute("disabled"),n.textContent=r,o.style.display="inline-block",o.textContent=`Error: ${s.message}`}))})({button:e.target,endpoint:"/classifai/v1/openai/generate-excerpt/",callback:o,buttonText:d})},d),(0,e.createElement)("span",{className:"spinner",style:{display:"none",float:"none"}}),(0,e.createElement)("span",{className:"error",style:{display:"none",color:"#bc0b0b",paddingTop:"5px"}}))})),{__:c}=wp.i18n,{withSelect:d}=wp.data,{PluginPrePublishPanel:u}=wp.editPost,{Component:m}=wp.element,h=t=>{let{children:n}=t;const s=[c("Suggestion:"),(0,e.createElement)("span",{className:"editor-post-publish-panel__link",key:"label"},c("Generate excerpt","classifai"))];return(0,e.createElement)(u,{title:s,icon:"aside",initialOpen:!0},n)},x=d((e=>({excerpt:e("core/editor").getEditedPostAttribute("excerpt"),isPublishPanelOpen:e("core/edit-post").isPublishSidebarOpened()})))(class extends m{constructor(e){super(e),this.state={hadExcerptWhenOpeningThePanel:""!==e.excerpt}}componentDidUpdate(e){this.props.isPublishPanelOpen&&e.isPublishPanelOpen!==this.props.isPublishPanelOpen&&this.setState({hadExcerptWhenOpeningThePanel:""!==this.props.excerpt})}render(){return this.state.hadExcerptWhenOpeningThePanel?null:(0,e.createElement)(h,null,this.props.children)}}),{__:b}=wp.i18n,{dispatch:g}=wp.data,{PluginDocumentSettingPanel:E}=wp.editPost,{PostExcerptCheck:P}=wp.editor,{registerPlugin:w}=wp.plugins;g("core/edit-post").removeEditorPanel("post-excerpt"),w("post-excerpt",{render:()=>(0,e.createElement)(P,null,(0,e.createElement)(E,{title:b("Excerpt")},(0,e.createElement)(p,null)),(0,e.createElement)(x,null,(0,e.createElement)(p,null)))})})();