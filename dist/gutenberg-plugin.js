(()=>{"use strict";const e=window.wp.element,t=window.React;var s;function n(){return n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n])}return e},n.apply(this,arguments)}var a=function(e){return t.createElement("svg",n({width:20,height:15,viewBox:"0 0 61 46",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),s||(s=t.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3.52 0C1.575 0 0 1.584 0 3.538v38.924C0 44.416 1.576 46 3.52 46h53.96c1.944 0 3.52-1.584 3.52-3.538V3.538C61 1.584 59.424 0 57.48 0H3.52Zm13.189 8.138h4.739L33.58 39.554h-6.056l-3.492-9.04H13.97l-3.453 9.04h-5.96L16.709 8.138Zm2.38 8.563c-.104.34-.211.672-.319.997l-.012.036-2.76 7.406h6.148l-2.745-7.455-.312-.984Zm21.227-8.563h12.59v4.015l-3.413.819V34.63l3.413.779v4.024h-12.59V35.41l3.413-.78V12.972l-3.413-.818V8.138Z",fill:"#1e1e1e"})))};const i=window.wp.i18n,{get:o}=lodash,l=window.wp.data,r=window.wp.editPost,c=window.wp.components,d=window.wp.plugins,{classifaiPostData:p}=window,u=()=>(0,e.createElement)(c.Icon,{className:"components-panel__icon",icon:a,size:24}),g=()=>{const t=(0,l.useSelect)((e=>e("core/editor").getEditedPostAttribute("classifai_process_content"))),{editPost:s}=(0,l.useDispatch)("core/editor"),n="no"===t?"no":"yes";return(0,e.createElement)(c.ToggleControl,{label:(0,i.__)("Process content on update","classifai"),help:"yes"===n?(0,i.__)("ClassifAI language processing is enabled","classifai"):(0,i.__)("ClassifAI language processing is disabled","classifai"),checked:"yes"===n,onChange:e=>{s({classifai_process_content:e?"yes":"no"})}})},m=async e=>{const{select:t,dispatch:s}=wp.data,n=t("core/editor").getCurrentPostId(),a=t("core/editor").getCurrentPostType(),o=t("core/editor").getPostTypeLabel()||(0,i.__)("Post","classifai");if(e&&e.terms){let l=!1;const r=Object.keys(e.terms),c={};if(r.forEach((s=>{let n=s;"post_tag"===s&&(n="tags"),"category"===s&&(n="categories");const a=[...t("core/editor").getEditedPostAttribute(s)||[],...e.terms[s].map((e=>Number.parseInt(e)))].filter(((e,t,s)=>s.indexOf(e)===t));a&&a.length&&(l=!0,c[n]=a)})),l){const e=await t("core/editor").isEditedPostDirty();await s("core").editEntityRecord("postType",a,n,c),e||await s("core").saveEditedEntityRecord("postType",a,n),s("core/notices").createSuccessNotice((0,i.sprintf)(/** translators: %s is post type label. */
(0,i.__)("%s classified successfully.","classifai"),o),{type:"snackbar"})}}},y=()=>{if("yes"==("no"===(0,l.useSelect)((e=>e("core/editor").getEditedPostAttribute("classifai_process_content")))?"no":"yes"))return null;const t=wp.data.select("core/editor").getCurrentPostId(),s=wp.data.select("core/editor").getPostTypeLabel()||(0,i.__)("Post","classifai"),n=(0,i.sprintf)(/** translators: %s Post type label */
(0,i.__)("Classify %s","classifai"),s);return(0,e.createElement)(e.Fragment,null,(0,e.createElement)(c.Button,{variant:"secondary","data-id":t,onClick:e=>(e=>{let{button:t,endpoint:s,callback:n=!1,buttonText:a=(0,i.__)("Rescan","classifai")}=e;const l=t.getAttribute("data-id"),[r]=t.parentNode.getElementsByClassName("spinner"),[c]=t.parentNode.getElementsByClassName("error"),d=`${s}${l}`;t.setAttribute("disabled","disabled"),r.style.display="inline-block",r.classList.add("is-active"),c.style.display="none",wp.apiRequest({path:d}).then((e=>{t.removeAttribute("disabled"),r.style.display="none",r.classList.remove("is-active"),t.textContent=a,n&&n(e)}),(e=>{const s=o(e,"responseJSON",{code:"unknown_error",message:(0,i.__)("An unknown error occurred.","classifai")});r.style.display="none",r.classList.remove("is-active"),t.removeAttribute("disabled"),t.textContent=a,c.style.display="inline-block",c.textContent=`Error: ${s.message}`}))})({button:e.target,endpoint:"/classifai/v1/generate-tags/",callback:m,buttonText:n})},n),(0,e.createElement)("span",{className:"spinner",style:{display:"none",float:"none"}}),(0,e.createElement)("span",{className:"error",style:{display:"none",color:"#bc0b0b",padding:"5px"}}))};(0,d.registerPlugin)("classifai-plugin",{render:()=>{const t=(0,l.useSelect)((e=>e("core/editor").getCurrentPostType())),s=(0,l.useSelect)((e=>e("core/editor").getCurrentPostAttribute("status")));return p.noPermissions&&1===parseInt(p.noPermissions)?null:p.NLUEnabled?p.supportedPostTypes&&!p.supportedPostTypes.includes(t)||p.supportedPostStatues&&!p.supportedPostStatues.includes(s)?null:(0,e.createElement)(r.PluginDocumentSettingPanel,{title:(0,i.__)("ClassifAI","classifai"),icon:u,className:"classifai-panel"},(0,e.createElement)(e.Fragment,null,(0,e.createElement)(g,null),(0,e.createElement)(y,null))):null}})})();